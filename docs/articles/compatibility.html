<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>dplyr compatibility • dplyr</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="../tidyverse.css" rel="stylesheet">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- tidyverse --><link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><!-- mathjax --><script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-vignette">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>

      <div class="navbar-brand-container">
        <a class="navbar-brand" href="../index.html">dplyr</a>
        <small class="tidyverse">part of the <a href="http://tidyverse.org">tidyverse</a></small>
      </div>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav navbar-right">
<li>
  <a href="../articles/dplyr.html">Intro</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/two-table.html">Two-table verbs</a>
    </li>
    <li>
      <a href="../articles/window-functions.html">Window functions</a>
    </li>
    <li>
      <a href="../articles/programming.html">Programming with dplyr</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
        <li>
  <a href="https://github.com/tidyverse/dplyr">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9">
    <div class="page-header toc-ignore">
      <h1>dplyr compatibility</h1>
            
          </div>

    
    
<div class="contents">
<p>This vignette is aimed at package authors who need to update their code because of a backward incompatible change to dplyr. We do try and minimise backward incompatible changes as much as possible, but sometimes they are necessary in order to radically simplify existing code, or unlock a lot of potential value in the future.</p>
<p>This vignette starts with some general advice on writing package code that works with multiple version of dplyr, then continues to discuss specific changes in dplyr versions.</p>
<div id="working-with-multiple-dplyr-versions" class="section level2">
<h2 class="hasAnchor">
<a href="#working-with-multiple-dplyr-versions" class="anchor"></a>Working with multiple dplyr versions</h2>
<p>Ideally, you want to make sure that your package works with both the released version and the development version of dplyr. This is typically a little bit more work, but has two big advantages:</p>
<ol style="list-style-type: decimal">
<li><p>It’s more convenient for your users, since they’re not forced to update dplyr if they don’t want to)</p></li>
<li><p>It’s easier on CRAN since it doesn’t require a massive coordinated release of multiple packages.</p></li>
</ol>
<p>To make code work with multiple versions of a package, your first tool is the simple if statement:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">if (utils::<span class="kw">packageVersion</span>(<span class="st">"dplyr"</span>) &gt;<span class="st"> "0.5.0"</span>) {
  <span class="co"># code for new version</span>
} else {
  <span class="co"># code for old version</span>
}</code></pre></div>
<p>Always condition on <code>&gt; current-version</code>, not <code>&gt;= next-version</code> because this will ensure that this branch is also used for the development version of the package. For example, if the current release is version “0.5.0”, the development version will be “0.5.0.9000”.</p>
<p>Occasionally, you’ll run into a situation where the <code>NAMESPACE</code> has changed and you need to conditionally import different functions. This typically occurs when functions are moved from one package to another. We try out best to provide automatic fallbacks, but this is not always possible. Often you can work around the problem by avoiding <code>importFrom</code> and using <code>::</code> instead. Do this where possible:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">if (utils::<span class="kw">packageVersion</span>(<span class="st">"dplyr"</span>) &gt;<span class="st"> "0.5.0"</span>) {
  dbplyr::<span class="kw">build_sql</span>(...)
} else {
  dplyr::<span class="kw">build_sql</span>(...)
}</code></pre></div>
<p>This will generate an <code>R CMD check</code> NOTE (because the one of the functions will always be missing), but this is ok. Simply explain that you get the note because you have written a wrapper to make sure your code is backward compatible.</p>
<p>Sometimes it’s not possible to avoid <code>importFrom()</code>. For example you might be importing a generic so that you can define a method for it. In this case, you can take advantage of a little-known feature in the <code>NAMESPACE</code> file: you can include <code>if</code> statements.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#' @rawNamespace</span>
<span class="co">#' if (utils::packageVersion("dplyr") &gt; "0.5.0") {</span>
<span class="co">#'   importFrom("dbplyr", "build_sql")</span>
<span class="co">#' } else {</span>
<span class="co">#'   importFrom("dplyr", "build_sql")</span>
<span class="co">#' }</span></code></pre></div>
</div>
<div id="dplyr-0-6-0" class="section level2">
<h2 class="hasAnchor">
<a href="#dplyr-0-6-0" class="anchor"></a>dplyr 0.6.0</h2>
<div id="database-code-moves-to-dbplyr" class="section level3">
<h3 class="hasAnchor">
<a href="#database-code-moves-to-dbplyr" class="anchor"></a>Database code moves to dbplyr</h3>
<p>Almost all database related code has been moved out of dplyr and into a new package, <a href="http://github.com/hadley/dbplyr/">dbplyr</a>. This makes dplyr simpler, and will make it easier to release fixes for bugs that only affect databases. If you’ve implemented a database backend for dplyr, please read the <a href="https://github.com/hadley/dbplyr/blob/master/NEWS.md#backends">backend news</a> on the backend.</p>
<p>Depending on what generics you use, and what generics you provide methods for you, you may need to write some conditional code. To help make this easier we’ve written <code><a href="../reference/check_dbplyr.html">wrap_dbplyr_obj()</a></code> which will write the helper code for you:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/check_dbplyr.html">wrap_dbplyr_obj</a></span>(<span class="st">"build_sql"</span>)
<span class="co">#&gt; build_sql &lt;- function (obj_name) </span>
<span class="co">#&gt; {</span>
<span class="co">#&gt;     if (utils::packageVersion("dplyr") &gt; "0.5.0") {</span>
<span class="co">#&gt;         dplyr::check_dbplyr()</span>
<span class="co">#&gt;         dbplyr::build_sql(obj_name = obj_name)</span>
<span class="co">#&gt;     }</span>
<span class="co">#&gt;     else {</span>
<span class="co">#&gt;         dbplyr::build_sql(obj_name = obj_name)</span>
<span class="co">#&gt;     }</span>
<span class="co">#&gt; }</span>

<span class="kw"><a href="../reference/check_dbplyr.html">wrap_dbplyr_obj</a></span>(<span class="st">"base_agg"</span>)
<span class="co">#&gt; base_agg &lt;- function () </span>
<span class="co">#&gt; {</span>
<span class="co">#&gt;     if (utils::packageVersion("dplyr") &gt; "0.5.0") {</span>
<span class="co">#&gt;         dplyr::check_dbplyr()</span>
<span class="co">#&gt;         dbplyr::base_agg</span>
<span class="co">#&gt;     }</span>
<span class="co">#&gt;     else {</span>
<span class="co">#&gt;         dplyr::base_agg</span>
<span class="co">#&gt;     }</span>
<span class="co">#&gt; }</span></code></pre></div>
<p>Simply copy the results of this function in your package.</p>
<p>These will generate <code>R CMD check</code> NOTES, so make sure to tell CRAN that this is to ensure backward compatibility.</p>
</div>
<div id="deprecation-of-verb_" class="section level3">
<h3 class="hasAnchor">
<a href="#deprecation-of-verb_" class="anchor"></a>Deprecation of <code>verb_</code>
</h3>
</div>
<div id="deprecartion-of-mutate_each_" class="section level3">
<h3 class="hasAnchor">
<a href="#deprecartion-of-mutate_each_" class="anchor"></a>Deprecartion of <code>mutate_each_</code>
</h3>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#working-with-multiple-dplyr-versions">Working with multiple dplyr versions</a></li>
      <li><a href="#dplyr-0.6.0">dplyr 0.6.0</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="tidyverse">
  <p>dplyr is a part of the <strong>tidyverse</strong>, an ecosystem of packages designed with common APIs and a shared philosophy. Learn more at <a href="http://tidyverse.org">tidyverse.org</a>.</p>
</div>

<div class="author">
  <p>Developed by <a href="http://hadley.nz">Hadley Wickham</a>, Romain Francois, <a href="https://www.rstudio.com"><img src="http://tidyverse.org/rstudio-logo.svg" height="24"></a>.</p>
  <p>Site built by <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-67989-18', 'auto');
  ga('send', 'pageview');
</script></footer>
</div>

  </body>
</html>
