<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Recoding columns and replacing values • dplyr</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Source_Sans_Pro-0.4.10/font.css" rel="stylesheet">
<link href="../deps/Source_Code_Pro-0.4.10/font.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Recoding columns and replacing values">
<script src="https://cdn.jsdelivr.net/gh/posit-dev/supported-by-posit/js/badge.min.js" data-max-height="43" data-hide-below="1200" data-light-bg="#666f76" data-light-fg="#f9f9f9"></script><script defer data-domain="dplyr.tidyverse.org,all.tidyverse.org" src="https://plausible.io/js/plausible.js"></script><script async src="https://widget.kapa.ai/kapa-widget.bundle.js" data-button-hide="true" data-modal-disclaimer="This is a custom LLM for answering questions about dplyr, tidyr, and ggplot2. Answers are based on the contents of the documentation. Rate the answers to let us know what you think!" data-modal-ask-ai-input-placeholder="Ask me a question about dplyr, tidyr, or ggplot2." data-modal-header-bg-color="#f9f9f9" data-modal-override-open-class="open-kapa-widget" data-project-color="#365a7a" data-project-name="dplyr" data-modal-title="tidyverse AI ✨" data-project-logo="https://avatars.githubusercontent.com/u/22032646?s=200&amp;u=235532df5cf8543246812f73db051b793f868807&amp;v=4" data-user-analytics-fingerprint-enabled="true" data-bot-protection-mechanism="hcaptcha" data-website-id="44ae76c6-2ae5-4899-ab42-de9f17f07c7b"></script>
</head>
<body>
    <a href="#container" class="visually-hidden-focusable">Skip to content</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-none" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">dplyr</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">1.2.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/dplyr.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/grouping.html">Grouped data</a></li>
    <li><a class="dropdown-item" href="../articles/two-table.html">Two-table verbs</a></li>
    <li><a class="dropdown-item" href="../articles/recoding-replacing.html">Recoding columns and replacing values</a></li>
    <li><a class="dropdown-item" href="../articles/base.html">dplyr &lt;-&gt; base R</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Automation</h6></li>
    <li><a class="dropdown-item" href="../articles/colwise.html">Column-wise operations</a></li>
    <li><a class="dropdown-item" href="../articles/rowwise.html">Row-wise operations</a></li>
    <li><a class="dropdown-item" href="../articles/programming.html">Programming with dplyr</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../articles/index.html">More articles...</a></li>
  </ul>
</li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-news" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">News</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-news">
<li><h6 class="dropdown-header" data-toc-skip>Releases</h6></li>
    <li><a class="external-link dropdown-item" href="https://www.tidyverse.org/tags/dplyr-1-1-0/">Version 1.1.0</a></li>
    <li><a class="external-link dropdown-item" href="https://www.tidyverse.org/blog/2020/06/dplyr-1-0-0/">Version 1.0.0</a></li>
    <li><a class="external-link dropdown-item" href="https://www.tidyverse.org/blog/2019/07/dplyr-0-8-3/">Version 0.8.3</a></li>
    <li><a class="external-link dropdown-item" href="https://www.tidyverse.org/blog/2019/06/dplyr-0-8-2/">Version 0.8.2</a></li>
    <li><a class="external-link dropdown-item" href="https://www.tidyverse.org/blog/2019/05/dplyr-0-8-1/">Version 0.8.1</a></li>
    <li><a class="external-link dropdown-item" href="https://www.tidyverse.org/blog/2019/02/dplyr-0-8-0/">Version 0.8.0</a></li>
    <li><a class="external-link dropdown-item" href="https://www.tidyverse.org/blog/2018/06/dplyr-0.7.5/">Version 0.7.5</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../news/index.html">Changelog</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/tidyverse/dplyr/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item"><a class="nav-link open-kapa-widget" href="../#">Ask AI ✨</a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article" id="container">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Recoding columns and replacing values</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/tidyverse/dplyr/blob/main/vignettes/recoding-replacing.Rmd" class="external-link"><code>vignettes/recoding-replacing.Rmd</code></a></small>
      <div class="d-none name"><code>recoding-replacing.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>dplyr provides a family of functions for <em>recoding</em> columns
and <em>replacing</em> values within a column. These are extremely
common operations, so mastering this family can be a big productivity
boost!</p>
<p>Before we begin, it’ll be helpful to define exactly what we mean by
recoding vs replacing:</p>
<ul>
<li><p><em>Recoding</em> a column creates an entirely new column using
values from an existing column. The new column may have a different type
from the original column.</p></li>
<li><p><em>Replacing</em> values within a column partially updates an
existing column with new values. The result has the same type as the
original column.</p></li>
</ul>
<p>The family of functions can be summarized by the following table:</p>
<table class="table">
<thead><tr class="header">
<th></th>
<th><strong>Recoding</strong></th>
<th><strong>Replacing</strong></th>
</tr></thead>
<tbody>
<tr class="odd">
<td><strong>Match with conditions</strong></td>
<td><code><a href="../reference/case-and-replace-when.html">case_when()</a></code></td>
<td><code><a href="../reference/case-and-replace-when.html">replace_when()</a></code></td>
</tr>
<tr class="even">
<td><strong>Match with values</strong></td>
<td><code><a href="../reference/recode-and-replace-values.html">recode_values()</a></code></td>
<td><code><a href="../reference/recode-and-replace-values.html">replace_values()</a></code></td>
</tr>
</tbody>
</table>
<p>This vignette walks through use cases for each of these functions,
which should help you build some intuition about when to use them.</p>
</div>
<div class="section level2">
<h2 id="case_when">
<code>case_when()</code><a class="anchor" aria-label="anchor" href="#case_when"></a>
</h2>
<p><code><a href="../reference/case-and-replace-when.html">case_when()</a></code> is the most general function in the family.
It works by evaluating each case sequentially and using the first match
for each element to determine the corresponding value in the output. To
demonstrate, we’ll look at a dataset of some 5k times in minutes:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span><span class="va">racers</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>  id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="fl">100</span><span class="op">)</span>,</span>
<span>  time <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">1200</span><span class="op">:</span><span class="fl">2100</span>, size <span class="op">=</span> <span class="fl">100</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">/</span> <span class="fl">60</span>, <span class="fl">2</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">racers</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 100 × 2</span></span></span>
<span><span class="co">#&gt;       id  time</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>     1  26.9</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>     2  27.7</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>     3  23.0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>     4  28.8</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>     5  23.2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>     6  33.6</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>     7  22.0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>     8  25.0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>     9  23.8</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span>    10  24.0</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 90 more rows</span></span></span></code></pre></div>
<p>We can use <code><a href="../reference/case-and-replace-when.html">case_when()</a></code> to categorize these times into
tiers:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tiers</span> <span class="op">&lt;-</span> <span class="va">racers</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/mutate.html">mutate</a></span><span class="op">(</span></span>
<span>    tier <span class="op">=</span> <span class="fu"><a href="../reference/case-and-replace-when.html">case_when</a></span><span class="op">(</span></span>
<span>      <span class="va">time</span> <span class="op">&lt;</span> <span class="fl">23</span> <span class="op">~</span> <span class="st">"A"</span>,</span>
<span>      <span class="va">time</span> <span class="op">&lt;</span> <span class="fl">27</span> <span class="op">~</span> <span class="st">"B"</span>,</span>
<span>      <span class="va">time</span> <span class="op">&lt;</span> <span class="fl">30</span> <span class="op">~</span> <span class="st">"C"</span>,</span>
<span>      <span class="va">time</span> <span class="op">&lt;</span> <span class="fl">33</span> <span class="op">~</span> <span class="st">"D"</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">tiers</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 100 × 3</span></span></span>
<span><span class="co">#&gt;       id  time tier </span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>     1  26.9 B    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>     2  27.7 C    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>     3  23.0 A    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>     4  28.8 C    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>     5  23.2 B    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>     6  33.6 <span style="color: #BB0000;">NA</span>   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>     7  22.0 A    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>     8  25.0 B    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>     9  23.8 B    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span>    10  24.0 B    </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 90 more rows</span></span></span></code></pre></div>
<p>There’s a few things to note here:</p>
<ul>
<li><p>The <em>first</em> condition that is <code>TRUE</code> is used,
i.e. a time of 21 minutes meets all of the conditions, but would be
placed in tier <code>A</code> because <code>time &lt; 23</code> is
listed first.</p></li>
<li><p>Unmatched values fall through as <code>NA</code>. We have some
racers above 33 minutes that aren’t captured here!</p></li>
</ul>
<p>There are a few options for dealing with unmatched locations. You can
leave them as <code>NA</code> if that makes sense for your use case, or
you can specify a <code>.default</code> value:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">racers</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/mutate.html">mutate</a></span><span class="op">(</span></span>
<span>    tier <span class="op">=</span> <span class="fu"><a href="../reference/case-and-replace-when.html">case_when</a></span><span class="op">(</span></span>
<span>      <span class="va">time</span> <span class="op">&lt;</span> <span class="fl">23</span> <span class="op">~</span> <span class="st">"A"</span>,</span>
<span>      <span class="va">time</span> <span class="op">&lt;</span> <span class="fl">27</span> <span class="op">~</span> <span class="st">"B"</span>,</span>
<span>      <span class="va">time</span> <span class="op">&lt;</span> <span class="fl">30</span> <span class="op">~</span> <span class="st">"C"</span>,</span>
<span>      <span class="va">time</span> <span class="op">&lt;</span> <span class="fl">33</span> <span class="op">~</span> <span class="st">"D"</span>,</span>
<span>      .default <span class="op">=</span> <span class="st">"unknown"</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 100 × 3</span></span></span>
<span><span class="co">#&gt;       id  time tier   </span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>     1  26.9 B      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>     2  27.7 C      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>     3  23.0 A      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>     4  28.8 C      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>     5  23.2 B      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>     6  33.6 unknown</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>     7  22.0 A      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>     8  25.0 B      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>     9  23.8 B      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span>    10  24.0 B      </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 90 more rows</span></span></span></code></pre></div>
<p>If you are confident that you’ve captured every case, you can supply
<code>.unmatched = "error"</code> rather than <code>.default</code> and
<code><a href="../reference/case-and-replace-when.html">case_when()</a></code> will error if that assertion doesn’t hold. This
is great for defensive programming!</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">racers</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/mutate.html">mutate</a></span><span class="op">(</span></span>
<span>    tier <span class="op">=</span> <span class="fu"><a href="../reference/case-and-replace-when.html">case_when</a></span><span class="op">(</span></span>
<span>      <span class="va">time</span> <span class="op">&lt;</span> <span class="fl">23</span> <span class="op">~</span> <span class="st">"A"</span>,</span>
<span>      <span class="va">time</span> <span class="op">&lt;</span> <span class="fl">27</span> <span class="op">~</span> <span class="st">"B"</span>,</span>
<span>      <span class="va">time</span> <span class="op">&lt;</span> <span class="fl">30</span> <span class="op">~</span> <span class="st">"C"</span>,</span>
<span>      <span class="va">time</span> <span class="op">&lt;</span> <span class="fl">33</span> <span class="op">~</span> <span class="st">"D"</span>,</span>
<span>      .unmatched <span class="op">=</span> <span class="st">"error"</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00; font-weight: bold;">Error</span><span style="font-weight: bold;"> in `mutate()`:</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> In argument: `tier = case_when(...)`.</span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">Caused by error in `case_when()`:</span></span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00;">!</span> Each location must be matched.</span></span>
<span><span class="co">#&gt; <span style="color: #BB0000;">✖</span> Locations 6, 22, 32, 34, 40, 44, 55, 56, 73, 79, 84, and 93 are unmatched.</span></span></code></pre></div>
<p>Note that missing values must be explicitly handled when setting
<code>.unmatched = "error"</code>, even if that’s just
<code>is.na(time) ~ NA</code>, otherwise they will trigger the unmatched
error.</p>
</div>
<div class="section level2">
<h2 id="replace_when">
<code>replace_when()</code><a class="anchor" aria-label="anchor" href="#replace_when"></a>
</h2>
<p>Let’s assume that some of our racers used banned running shoes and
are disqualified. Also, some racers had a false start and need to incur
a 20 second (1/3 minute) penalty.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">id_banned_shoes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">10</span>, <span class="fl">15</span>, <span class="fl">32</span>, <span class="fl">65</span><span class="op">)</span></span>
<span><span class="va">id_false_start</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">5</span>, <span class="fl">20</span>, <span class="fl">55</span>, <span class="fl">74</span>, <span class="fl">91</span><span class="op">)</span></span></code></pre></div>
<p>We could add this information in a few ways. With
<code><a href="../reference/case-and-replace-when.html">case_when()</a></code>:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">racers</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/mutate.html">mutate</a></span><span class="op">(</span></span>
<span>    time <span class="op">=</span> <span class="fu"><a href="../reference/case-and-replace-when.html">case_when</a></span><span class="op">(</span></span>
<span>      <span class="va">id</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">id_banned_shoes</span> <span class="op">~</span> <span class="cn">NA</span>,</span>
<span>      <span class="va">id</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">id_false_start</span> <span class="op">~</span> <span class="va">time</span> <span class="op">+</span> <span class="fl">1</span> <span class="op">/</span> <span class="fl">3</span>,</span>
<span>      .default <span class="op">=</span> <span class="va">time</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 100 × 2</span></span></span>
<span><span class="co">#&gt;       id  time</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>     1  27.2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>     2  <span style="color: #BB0000;">NA</span>  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>     3  23.0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>     4  28.8</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>     5  23.6</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>     6  33.6</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>     7  22.0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>     8  25.0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>     9  23.8</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span>    10  <span style="color: #BB0000;">NA</span>  </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 90 more rows</span></span></span></code></pre></div>
<p>Or in two steps with <code><a href="../reference/if_else.html">if_else()</a></code>:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">racers</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/mutate.html">mutate</a></span><span class="op">(</span>time <span class="op">=</span> <span class="fu"><a href="../reference/if_else.html">if_else</a></span><span class="op">(</span><span class="va">id</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">id_banned_shoes</span>, <span class="cn">NA</span>, <span class="va">time</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/mutate.html">mutate</a></span><span class="op">(</span>time <span class="op">=</span> <span class="fu"><a href="../reference/if_else.html">if_else</a></span><span class="op">(</span><span class="va">id</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">id_false_start</span>, <span class="va">time</span> <span class="op">+</span> <span class="fl">1</span> <span class="op">/</span> <span class="fl">3</span>, <span class="va">time</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 100 × 2</span></span></span>
<span><span class="co">#&gt;       id  time</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>     1  27.2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>     2  <span style="color: #BB0000;">NA</span>  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>     3  23.0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>     4  28.8</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>     5  23.6</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>     6  33.6</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>     7  22.0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>     8  25.0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>     9  23.8</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span>    10  <span style="color: #BB0000;">NA</span>  </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 90 more rows</span></span></span></code></pre></div>
<p>Neither of these feel particularly elegant at expressing the
<em>intent</em> of this operation. All you’re trying to do is replace a
few values of <code>time</code>! We like to think of <code>time</code>
as the <em>primary</em> input: <code>time</code> goes in, and
<code>time</code> comes out (slightly adjusted). But both
<code><a href="../reference/case-and-replace-when.html">case_when()</a></code> and <code><a href="../reference/if_else.html">if_else()</a></code> have
<code>time</code> as their last input, making the intent a bit hard to
understand at first glance.</p>
<p><code><a href="../reference/case-and-replace-when.html">replace_when()</a></code> lets you pull the primary input to the
front (which also makes it compatible with the pipe!), making the intent
more clear:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">racers</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/mutate.html">mutate</a></span><span class="op">(</span></span>
<span>    time <span class="op">=</span> <span class="va">time</span> <span class="op">|&gt;</span></span>
<span>      <span class="fu"><a href="../reference/case-and-replace-when.html">replace_when</a></span><span class="op">(</span></span>
<span>        <span class="va">id</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">id_banned_shoes</span> <span class="op">~</span> <span class="cn">NA</span>,</span>
<span>        <span class="va">id</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">id_false_start</span> <span class="op">~</span> <span class="va">time</span> <span class="op">+</span> <span class="fl">1</span> <span class="op">/</span> <span class="fl">3</span></span>
<span>      <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 100 × 2</span></span></span>
<span><span class="co">#&gt;       id  time</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>     1  27.2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>     2  <span style="color: #BB0000;">NA</span>  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>     3  23.0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>     4  28.8</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>     5  23.6</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>     6  33.6</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>     7  22.0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>     8  25.0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>     9  23.8</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span>    10  <span style="color: #BB0000;">NA</span>  </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 90 more rows</span></span></span></code></pre></div>
<p>As a side note, you might have been tempted to reach for
<code><a href="https://rdrr.io/r/base/replace.html" class="external-link">base::replace()</a></code> here, i.e. as:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">racers</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/mutate.html">mutate</a></span><span class="op">(</span>time <span class="op">=</span> <span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/replace.html" class="external-link">replace</a></span><span class="op">(</span><span class="va">time</span>, <span class="va">id</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">id_banned_shoes</span>, <span class="cn">NA</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/mutate.html">mutate</a></span><span class="op">(</span>time <span class="op">=</span> <span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/replace.html" class="external-link">replace</a></span><span class="op">(</span><span class="va">time</span>, <span class="va">id</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">id_false_start</span>, <span class="va">time</span> <span class="op">+</span> <span class="fl">1</span> <span class="op">/</span> <span class="fl">3</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>This actually doesn’t work! Replacing with <code>NA</code> does work,
but <code><a href="https://rdrr.io/r/base/replace.html" class="external-link">replace()</a></code> requires that the result of
<code>time + 1 / 3</code> must be preemptively subset to the places
where the condition is true. You’d have to do something more complicated
to mimic <code><a href="../reference/case-and-replace-when.html">replace_when()</a></code>:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">racers</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/mutate.html">mutate</a></span><span class="op">(</span>time <span class="op">=</span> <span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/replace.html" class="external-link">replace</a></span><span class="op">(</span><span class="va">time</span>, <span class="va">id</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">id_banned_shoes</span>, <span class="cn">NA</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/mutate.html">mutate</a></span><span class="op">(</span>time <span class="op">=</span> <span class="op">{</span></span>
<span>    <span class="va">loc</span> <span class="op">&lt;-</span> <span class="va">id</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">id_false_start</span></span>
<span>    <span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/replace.html" class="external-link">replace</a></span><span class="op">(</span><span class="va">time</span>, <span class="va">loc</span>, <span class="va">time</span><span class="op">[</span><span class="va">loc</span><span class="op">]</span> <span class="op">+</span> <span class="fl">1</span> <span class="op">/</span> <span class="fl">3</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 100 × 2</span></span></span>
<span><span class="co">#&gt;       id  time</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>     1  27.2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>     2  <span style="color: #BB0000;">NA</span>  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>     3  23.0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>     4  28.8</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>     5  23.6</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>     6  33.6</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>     7  22.0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>     8  25.0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>     9  23.8</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span>    10  <span style="color: #BB0000;">NA</span>  </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 90 more rows</span></span></span></code></pre></div>
<div class="section level3">
<h3 id="type-stability">Type stability<a class="anchor" aria-label="anchor" href="#type-stability"></a>
</h3>
<p>Beyond readability, an important benefit of
<code><a href="../reference/case-and-replace-when.html">replace_when()</a></code> (and <code><a href="../reference/recode-and-replace-values.html">replace_values()</a></code>, which
we’ll see later) is that it is <em>type stable</em> on the column you
are modifying, which means that it can’t change types out from under
you.</p>
<p>Type stability is particularly useful with factors. Taking another
look at our <code>tiers</code> of race times, imagine that some of the
race times were discovered to be faulty due to malfunctioning timers,
and you need to replace a few <code>id</code>s with the
<code>unknown</code> level.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">id_with_malfunction</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">5</span>, <span class="fl">20</span>, <span class="fl">50</span><span class="op">)</span></span>
<span></span>
<span><span class="va">tiers</span> <span class="op">&lt;-</span> <span class="va">racers</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/mutate.html">mutate</a></span><span class="op">(</span></span>
<span>    tier <span class="op">=</span> <span class="fu"><a href="../reference/case-and-replace-when.html">case_when</a></span><span class="op">(</span></span>
<span>      <span class="va">time</span> <span class="op">&lt;</span> <span class="fl">23</span> <span class="op">~</span> <span class="st">"A"</span>,</span>
<span>      <span class="va">time</span> <span class="op">&lt;</span> <span class="fl">27</span> <span class="op">~</span> <span class="st">"B"</span>,</span>
<span>      <span class="va">time</span> <span class="op">&lt;</span> <span class="fl">30</span> <span class="op">~</span> <span class="st">"C"</span>,</span>
<span>      <span class="va">time</span> <span class="op">&lt;</span> <span class="fl">33</span> <span class="op">~</span> <span class="st">"D"</span>,</span>
<span>      .default <span class="op">=</span> <span class="st">"unknown"</span></span>
<span>    <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span>levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"A"</span>, <span class="st">"B"</span>, <span class="st">"C"</span>, <span class="st">"D"</span>, <span class="st">"unknown"</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">tiers</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 100 × 3</span></span></span>
<span><span class="co">#&gt;       id  time tier   </span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>     1  26.9 B      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>     2  27.7 C      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>     3  23.0 A      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>     4  28.8 C      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>     5  23.2 B      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>     6  33.6 unknown</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>     7  22.0 A      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>     8  25.0 B      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>     9  23.8 B      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span>    10  24.0 B      </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 90 more rows</span></span></span></code></pre></div>
<p>Note that the following <code><a href="../reference/case-and-replace-when.html">case_when()</a></code> solution results in
<code>tier</code> becoming a <em>character</em> column, losing its
factor class. This is due to the fact that <code><a href="../reference/case-and-replace-when.html">case_when()</a></code> is a
<em>recoding</em> function, it creates an entirely new column and
doesn’t know that you’re trying to retain existing type information.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tiers</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/mutate.html">mutate</a></span><span class="op">(</span></span>
<span>    tier <span class="op">=</span> <span class="fu"><a href="../reference/case-and-replace-when.html">case_when</a></span><span class="op">(</span><span class="va">id</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">id_with_malfunction</span> <span class="op">~</span> <span class="st">"unknown"</span>, .default <span class="op">=</span> <span class="va">tier</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 100 × 3</span></span></span>
<span><span class="co">#&gt;       id  time tier   </span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>     1  26.9 unknown</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>     2  27.7 C      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>     3  23.0 A      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>     4  28.8 C      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>     5  23.2 unknown</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>     6  33.6 unknown</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>     7  22.0 A      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>     8  25.0 B      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>     9  23.8 B      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span>    10  24.0 B      </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 90 more rows</span></span></span></code></pre></div>
<p>As a <em>replacing</em> function, <code><a href="../reference/case-and-replace-when.html">replace_when()</a></code> knows
to be type stable on <code>tier</code>, and casts <code>"unknown"</code>
to <code>tier</code>’s factor type before performing the
replacement:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tiers</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/mutate.html">mutate</a></span><span class="op">(</span></span>
<span>    tier <span class="op">=</span> <span class="va">tier</span> <span class="op">|&gt;</span> <span class="fu"><a href="../reference/case-and-replace-when.html">replace_when</a></span><span class="op">(</span><span class="va">id</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">id_with_malfunction</span> <span class="op">~</span> <span class="st">"unknown"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 100 × 3</span></span></span>
<span><span class="co">#&gt;       id  time tier   </span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>     1  26.9 unknown</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>     2  27.7 C      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>     3  23.0 A      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>     4  28.8 C      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>     5  23.2 unknown</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>     6  33.6 unknown</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>     7  22.0 A      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>     8  25.0 B      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>     9  23.8 B      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span>    10  24.0 B      </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 90 more rows</span></span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="recode_values">
<code>recode_values()</code><a class="anchor" aria-label="anchor" href="#recode_values"></a>
</h2>
<p><code><a href="../reference/case-and-replace-when.html">case_when()</a></code> and <code><a href="../reference/case-and-replace-when.html">replace_when()</a></code> both take
<em>logical</em> vectors on the left-hand side of the formula. This is
very flexible, but sometimes these functions require a large amount of
repetition. Consider the following <a href="https://en.wikipedia.org/wiki/Likert_scale" class="external-link">Likert scale</a>
scores. We’d like to recode these from their numeric values to their
character counterparts.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">likert</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>  score <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">4</span>, <span class="fl">5</span>, <span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">1</span>, <span class="fl">4</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>We could certainly use a <code><a href="../reference/case-and-replace-when.html">case_when()</a></code>:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">likert</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/mutate.html">mutate</a></span><span class="op">(</span></span>
<span>    score <span class="op">=</span> <span class="fu"><a href="../reference/case-and-replace-when.html">case_when</a></span><span class="op">(</span></span>
<span>      <span class="va">score</span> <span class="op">==</span> <span class="fl">1</span> <span class="op">~</span> <span class="st">"Strongly disagree"</span>,</span>
<span>      <span class="va">score</span> <span class="op">==</span> <span class="fl">2</span> <span class="op">~</span> <span class="st">"Disagree"</span>,</span>
<span>      <span class="va">score</span> <span class="op">==</span> <span class="fl">3</span> <span class="op">~</span> <span class="st">"Neutral"</span>,</span>
<span>      <span class="va">score</span> <span class="op">==</span> <span class="fl">4</span> <span class="op">~</span> <span class="st">"Agree"</span>,</span>
<span>      <span class="va">score</span> <span class="op">==</span> <span class="fl">5</span> <span class="op">~</span> <span class="st">"Strongly agree"</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 9 × 1</span></span></span>
<span><span class="co">#&gt;   score            </span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>            </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> Strongly disagree</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> Disagree         </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> Neutral          </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> Agree            </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> Strongly agree   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> Disagree         </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">7</span> Neutral          </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">8</span> Strongly disagree</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">9</span> Agree</span></span></code></pre></div>
<p>But <code>score ==</code> is repeated many times! If you find
yourself using <code>==</code> or <code>%in%</code> on the left-hand
side in this manner, you likely want to use <code><a href="../reference/recode-and-replace-values.html">recode_values()</a></code>
instead. Rather than taking logical vectors,
<code><a href="../reference/recode-and-replace-values.html">recode_values()</a></code> takes <em>values</em> on the left-hand side
to match against a single input that you’ll provide as the first
argument.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">likert</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/mutate.html">mutate</a></span><span class="op">(</span></span>
<span>    score <span class="op">=</span> <span class="va">score</span> <span class="op">|&gt;</span></span>
<span>      <span class="fu"><a href="../reference/recode-and-replace-values.html">recode_values</a></span><span class="op">(</span></span>
<span>        <span class="fl">1</span> <span class="op">~</span> <span class="st">"Strongly disagree"</span>,</span>
<span>        <span class="fl">2</span> <span class="op">~</span> <span class="st">"Disagree"</span>,</span>
<span>        <span class="fl">3</span> <span class="op">~</span> <span class="st">"Neutral"</span>,</span>
<span>        <span class="fl">4</span> <span class="op">~</span> <span class="st">"Agree"</span>,</span>
<span>        <span class="fl">5</span> <span class="op">~</span> <span class="st">"Strongly agree"</span></span>
<span>      <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 9 × 1</span></span></span>
<span><span class="co">#&gt;   score            </span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>            </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> Strongly disagree</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> Disagree         </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> Neutral          </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> Agree            </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> Strongly agree   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> Disagree         </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">7</span> Neutral          </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">8</span> Strongly disagree</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">9</span> Agree</span></span></code></pre></div>
<p>This removes all of the repetition, allowing you to focus on the
mapping. If you squint, the mapping should look roughly like a lookup
table between the numeric value and the likert encoding.
<code><a href="../reference/recode-and-replace-values.html">recode_values()</a></code> actually has a second interface that allows
us to make this lookup table representation even more explicit.</p>
<p>Using a <code><a href="https://tibble.tidyverse.org/reference/tribble.html" class="external-link">tribble()</a></code>, we can extract out the lookup table
into its own standalone data frame.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lookup</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tribble.html" class="external-link">tribble</a></span><span class="op">(</span></span>
<span>  <span class="op">~</span><span class="va">from</span> , <span class="op">~</span><span class="va">to</span>                 ,</span>
<span>      <span class="fl">1</span> , <span class="st">"Strongly disagree"</span> ,</span>
<span>      <span class="fl">2</span> , <span class="st">"Disagree"</span>          ,</span>
<span>      <span class="fl">3</span> , <span class="st">"Neutral"</span>           ,</span>
<span>      <span class="fl">4</span> , <span class="st">"Agree"</span>             ,</span>
<span>      <span class="fl">5</span> , <span class="st">"Strongly agree"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>We can then utilize the alternative <code>from</code> and
<code>to</code> arguments of <code><a href="../reference/recode-and-replace-values.html">recode_values()</a></code> rather than
supplying formulas to specify how the values should be recoded:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">likert</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/mutate.html">mutate</a></span><span class="op">(</span>score <span class="op">=</span> <span class="fu"><a href="../reference/recode-and-replace-values.html">recode_values</a></span><span class="op">(</span><span class="va">score</span>, from <span class="op">=</span> <span class="va">lookup</span><span class="op">$</span><span class="va">from</span>, to <span class="op">=</span> <span class="va">lookup</span><span class="op">$</span><span class="va">to</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 9 × 1</span></span></span>
<span><span class="co">#&gt;   score            </span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>            </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> Strongly disagree</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> Disagree         </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> Neutral          </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> Agree            </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> Strongly agree   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> Disagree         </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">7</span> Neutral          </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">8</span> Strongly disagree</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">9</span> Agree</span></span></code></pre></div>
<p>Lifting the lookup table to the top of the file is particularly nice
when you have a long pipe chain. The details of the mapping get some
room to breathe, and in the pipe chain you can focus on the actual
manipulations you are trying to perform.</p>
<p>It’s also very common for your <code>lookup</code> table to exist in
a CSV file that you have to read in separately. In that case, you can
replace the <code><a href="https://tibble.tidyverse.org/reference/tribble.html" class="external-link">tribble()</a></code> call with:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lookup</span> <span class="op">&lt;-</span> <span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html" class="external-link">read_csv</a></span><span class="op">(</span><span class="st">"lookup.csv"</span><span class="op">)</span></span></code></pre></div>
<p>But everything else works the same. This would be quite hard to
specify with just the formula interface!</p>
<p>Like <code><a href="../reference/case-and-replace-when.html">case_when()</a></code>, <code><a href="../reference/recode-and-replace-values.html">recode_values()</a></code> also has
<code>default</code> and <code>unmatched</code> arguments to handle
unmatched locations:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">likert</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>  score <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">2</span>, <span class="fl">4</span>, <span class="fl">5</span>, <span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">1</span>, <span class="fl">4</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Missed the `0`</span></span>
<span><span class="va">likert</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/mutate.html">mutate</a></span><span class="op">(</span></span>
<span>    score <span class="op">=</span> <span class="va">score</span> <span class="op">|&gt;</span></span>
<span>      <span class="fu"><a href="../reference/recode-and-replace-values.html">recode_values</a></span><span class="op">(</span></span>
<span>        from <span class="op">=</span> <span class="va">lookup</span><span class="op">$</span><span class="va">from</span>,</span>
<span>        to <span class="op">=</span> <span class="va">lookup</span><span class="op">$</span><span class="va">to</span>,</span>
<span>        unmatched <span class="op">=</span> <span class="st">"error"</span></span>
<span>      <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00; font-weight: bold;">Error</span><span style="font-weight: bold;"> in `mutate()`:</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> In argument: `score = recode_values(score, from =</span></span>
<span><span class="co">#&gt;   lookup$from, to = lookup$to, unmatched = "error")`.</span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">Caused by error in `recode_values()`:</span></span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00;">!</span> Each location must be matched.</span></span>
<span><span class="co">#&gt; <span style="color: #BB0000;">✖</span> Location 1 is unmatched.</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="replace_values">
<code>replace_values()</code><a class="anchor" aria-label="anchor" href="#replace_values"></a>
</h2>
<p>As seen above, when replacing a few locations in a column using
<em>logical conditions</em>, we reached for <code><a href="../reference/case-and-replace-when.html">replace_when()</a></code>
rather than <code><a href="../reference/case-and-replace-when.html">case_when()</a></code>. Similarly, when replacing a few
locations using <em>values</em> to match against, it’s best to use
<code><a href="../reference/recode-and-replace-values.html">replace_values()</a></code> over <code><a href="../reference/recode-and-replace-values.html">recode_values()</a></code>.</p>
<p>Imagine we’d like to collapse some, but not all, of these school
names into common buckets:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">schools</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>  name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="st">"UNC"</span>,</span>
<span>    <span class="st">"Chapel Hill"</span>,</span>
<span>    <span class="cn">NA</span>,</span>
<span>    <span class="st">"Duke"</span>,</span>
<span>    <span class="st">"Duke University"</span>,</span>
<span>    <span class="st">"UNC"</span>,</span>
<span>    <span class="st">"NC State"</span>,</span>
<span>    <span class="st">"ECU"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>We could use <code><a href="../reference/recode-and-replace-values.html">recode_values()</a></code>:</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">schools</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/mutate.html">mutate</a></span><span class="op">(</span></span>
<span>    name <span class="op">=</span> <span class="fu"><a href="../reference/recode-and-replace-values.html">recode_values</a></span><span class="op">(</span></span>
<span>      <span class="va">name</span>,</span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"UNC"</span>, <span class="st">"Chapel Hill"</span><span class="op">)</span> <span class="op">~</span> <span class="st">"UNC Chapel Hill"</span>,</span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Duke"</span>, <span class="st">"Duke University"</span><span class="op">)</span> <span class="op">~</span> <span class="st">"Duke"</span>,</span>
<span>      default <span class="op">=</span> <span class="va">name</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 8 × 1</span></span></span>
<span><span class="co">#&gt;   name           </span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> UNC Chapel Hill</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> UNC Chapel Hill</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> <span style="color: #BB0000;">NA</span>             </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> Duke           </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> Duke           </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> UNC Chapel Hill</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">7</span> NC State       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">8</span> ECU</span></span></code></pre></div>
<p>But this “partial update by value” is so common that it really
deserves its own name that doesn’t require you to specify
<code>default</code>. For that, we have
<code><a href="../reference/recode-and-replace-values.html">replace_values()</a></code>:</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">schools</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/mutate.html">mutate</a></span><span class="op">(</span></span>
<span>    name <span class="op">=</span> <span class="va">name</span> <span class="op">|&gt;</span></span>
<span>      <span class="fu"><a href="../reference/recode-and-replace-values.html">replace_values</a></span><span class="op">(</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"UNC"</span>, <span class="st">"Chapel Hill"</span><span class="op">)</span> <span class="op">~</span> <span class="st">"UNC Chapel Hill"</span>,</span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Duke"</span>, <span class="st">"Duke University"</span><span class="op">)</span> <span class="op">~</span> <span class="st">"Duke"</span></span>
<span>      <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 8 × 1</span></span></span>
<span><span class="co">#&gt;   name           </span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> UNC Chapel Hill</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> UNC Chapel Hill</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> <span style="color: #BB0000;">NA</span>             </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> Duke           </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> Duke           </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> UNC Chapel Hill</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">7</span> NC State       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">8</span> ECU</span></span></code></pre></div>
<p>Like <code><a href="../reference/recode-and-replace-values.html">recode_values()</a></code>, <code><a href="../reference/recode-and-replace-values.html">replace_values()</a></code> has
an alternative <code>from</code> and <code>to</code> API that works well
with lookup tables and allows you to move your mapping out of the pipe
chain:</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lookup</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tribble.html" class="external-link">tribble</a></span><span class="op">(</span></span>
<span>  <span class="op">~</span><span class="va">from</span>             , <span class="op">~</span><span class="va">to</span>               ,</span>
<span>  <span class="st">"UNC"</span>             , <span class="st">"UNC Chapel Hill"</span> ,</span>
<span>  <span class="st">"Chapel Hill"</span>     , <span class="st">"UNC Chapel Hill"</span> ,</span>
<span>  <span class="st">"Duke"</span>            , <span class="st">"Duke"</span>            ,</span>
<span>  <span class="st">"Duke University"</span> , <span class="st">"Duke"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">schools</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/mutate.html">mutate</a></span><span class="op">(</span>name <span class="op">=</span> <span class="fu"><a href="../reference/recode-and-replace-values.html">replace_values</a></span><span class="op">(</span><span class="va">name</span>, from <span class="op">=</span> <span class="va">lookup</span><span class="op">$</span><span class="va">from</span>, to <span class="op">=</span> <span class="va">lookup</span><span class="op">$</span><span class="va">to</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 8 × 1</span></span></span>
<span><span class="co">#&gt;   name           </span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> UNC Chapel Hill</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> UNC Chapel Hill</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> <span style="color: #BB0000;">NA</span>             </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> Duke           </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> Duke           </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> UNC Chapel Hill</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">7</span> NC State       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">8</span> ECU</span></span></code></pre></div>
<p>An extremely neat feature of the <code>from</code> and
<code>to</code> API is that they also take <em>lists</em> of vectors
that describe the mapping, which has been designed to work elegantly
with the fact that <code><a href="https://tibble.tidyverse.org/reference/tribble.html" class="external-link">tribble()</a></code> can create list columns,
allowing you to further collapse this lookup table:</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Condensed lookup table with a `many:1` mapping per row</span></span>
<span><span class="va">lookup</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tribble.html" class="external-link">tribble</a></span><span class="op">(</span></span>
<span>  <span class="op">~</span><span class="va">from</span>                        , <span class="op">~</span><span class="va">to</span>               ,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"UNC"</span>, <span class="st">"Chapel Hill"</span><span class="op">)</span>      , <span class="st">"UNC Chapel Hill"</span> ,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Duke"</span>, <span class="st">"Duke University"</span><span class="op">)</span> , <span class="st">"Duke"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Note that `from` is a list column</span></span>
<span><span class="va">lookup</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 2 × 2</span></span></span>
<span><span class="co">#&gt;   from      to             </span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> <span style="color: #949494;">&lt;chr [2]&gt;</span> UNC Chapel Hill</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> <span style="color: #949494;">&lt;chr [2]&gt;</span> Duke</span></span>
<span></span>
<span><span class="va">lookup</span><span class="op">$</span><span class="va">from</span></span>
<span><span class="co">#&gt; [[1]]</span></span>
<span><span class="co">#&gt; [1] "UNC"         "Chapel Hill"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[2]]</span></span>
<span><span class="co">#&gt; [1] "Duke"            "Duke University"</span></span>
<span></span>
<span><span class="co"># Works the same as before</span></span>
<span><span class="va">schools</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/mutate.html">mutate</a></span><span class="op">(</span>name <span class="op">=</span> <span class="fu"><a href="../reference/recode-and-replace-values.html">replace_values</a></span><span class="op">(</span><span class="va">name</span>, from <span class="op">=</span> <span class="va">lookup</span><span class="op">$</span><span class="va">from</span>, to <span class="op">=</span> <span class="va">lookup</span><span class="op">$</span><span class="va">to</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 8 × 1</span></span></span>
<span><span class="co">#&gt;   name           </span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> UNC Chapel Hill</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> UNC Chapel Hill</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> <span style="color: #BB0000;">NA</span>             </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> Duke           </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> Duke           </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> UNC Chapel Hill</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">7</span> NC State       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">8</span> ECU</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="comparisons">Comparisons<a class="anchor" aria-label="anchor" href="#comparisons"></a>
</h2>
<p>We’ll end this vignette with some comparisons of the recoding and
replacing family to other dplyr functions and to other technologies,
like SQL.</p>
<div class="section level3">
<h3 id="if_else">
<code>if_else()</code><a class="anchor" aria-label="anchor" href="#if_else"></a>
</h3>
<p><code><a href="../reference/if_else.html">if_else()</a></code> is a type of recoding function, as it creates
an entirely new column. In fact, it’s closely tied to
<code><a href="../reference/case-and-replace-when.html">case_when()</a></code>:</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/if_else.html">if_else</a></span><span class="op">(</span><span class="va">condition</span>, <span class="va">true</span>, <span class="va">false</span>, <span class="va">missing</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/case-and-replace-when.html">case_when</a></span><span class="op">(</span></span>
<span>  <span class="va">condition</span> <span class="op">~</span> <span class="va">true</span>,</span>
<span>  <span class="op">!</span><span class="va">condition</span> <span class="op">~</span> <span class="va">false</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">condition</span><span class="op">)</span> <span class="op">~</span> <span class="va">missing</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Similar to <code><a href="../reference/case-and-replace-when.html">case_when()</a></code>, <code><a href="../reference/if_else.html">if_else()</a></code> doesn’t
offer type stability on any particular input. The output’s type is
computed as the common type of <code>true</code>, <code>false</code>,
and <code>missing</code>. If you find yourself writing an
<code><a href="../reference/if_else.html">if_else()</a></code> where the purpose is to partially update an
existing column, consider using <code><a href="../reference/case-and-replace-when.html">replace_when()</a></code> instead for
clarity and type stability:</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/if_else.html">if_else</a></span><span class="op">(</span><span class="va">x</span> <span class="op">&gt;</span> <span class="fl">5</span>, <span class="va">new</span>, <span class="va">x</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Type stable on `x`.</span></span>
<span><span class="co"># Intent of "partially updating" `x` is clear.</span></span>
<span><span class="co"># Pipe friendly.</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="va">x</span> <span class="op">|&gt;</span> <span class="fu"><a href="../reference/case-and-replace-when.html">replace_when</a></span><span class="op">(</span><span class="va">x</span> <span class="op">&gt;</span> <span class="fl">5</span> <span class="op">~</span> <span class="va">new</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="coalesce">
<code>coalesce()</code><a class="anchor" aria-label="anchor" href="#coalesce"></a>
</h3>
<p>For converting from <code>NA</code> to some other value, the most
common cases of <code><a href="../reference/coalesce.html">coalesce()</a></code> are often a
<code><a href="../reference/recode-and-replace-values.html">replace_values()</a></code> call in disguise:</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="cn">NA</span>, <span class="fl">3</span>, <span class="cn">NA</span>, <span class="fl">5</span><span class="op">)</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">3</span>, <span class="fl">1</span>, <span class="fl">4</span>, <span class="fl">6</span>, <span class="fl">7</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/coalesce.html">coalesce</a></span><span class="op">(</span><span class="va">x</span>, <span class="fl">0</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 1 2 0 3 0 5</span></span>
<span><span class="fu"><a href="../reference/recode-and-replace-values.html">replace_values</a></span><span class="op">(</span><span class="va">x</span>, <span class="cn">NA</span> <span class="op">~</span> <span class="fl">0</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 1 2 0 3 0 5</span></span>
<span></span>
<span><span class="fu"><a href="../reference/coalesce.html">coalesce</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 1 2 1 3 6 5</span></span>
<span><span class="fu"><a href="../reference/recode-and-replace-values.html">replace_values</a></span><span class="op">(</span><span class="va">x</span>, <span class="cn">NA</span> <span class="op">~</span> <span class="va">y</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 1 2 1 3 6 5</span></span></code></pre></div>
<p>And with <code><a href="../reference/recode-and-replace-values.html">replace_values()</a></code> you can replace any value, not
just <code>NA</code>.</p>
</div>
<div class="section level3">
<h3 id="na_if">
<code>na_if()</code><a class="anchor" aria-label="anchor" href="#na_if"></a>
</h3>
<p>For converting from a problematic value to <code>NA</code>,
<code><a href="../reference/recode-and-replace-values.html">replace_values()</a></code> is a more flexible (and likely more
intuitive) alternative to <code><a href="../reference/na_if.html">na_if()</a></code>:</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">0</span>, <span class="op">-</span><span class="fl">99</span>, <span class="fl">12</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># To convert `0` and `-99` to `NA`, you have to do it in two calls</span></span>
<span><span class="va">x</span> <span class="op">|&gt;</span> <span class="fu"><a href="../reference/na_if.html">na_if</a></span><span class="op">(</span><span class="fl">0</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="../reference/na_if.html">na_if</a></span><span class="op">(</span><span class="op">-</span><span class="fl">99</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1]  1  2 NA NA 12</span></span>
<span></span>
<span><span class="va">x</span> <span class="op">|&gt;</span> <span class="fu"><a href="../reference/recode-and-replace-values.html">replace_values</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="op">-</span><span class="fl">99</span><span class="op">)</span>, to <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1]  1  2 NA NA 12</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="sql">SQL<a class="anchor" aria-label="anchor" href="#sql"></a>
</h3>
<p><code><a href="../reference/case-and-replace-when.html">case_when()</a></code> is an R equivalent of SQL’s <a href="https://learn.microsoft.com/en-us/sql/t-sql/language-elements/case-transact-sql?view=sql-server-ver17#syntax" class="external-link">Searched
<code>CASE</code></a> statement:</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/case-and-replace-when.html">case_when</a></span><span class="op">(</span></span>
<span>  <span class="va">x</span> <span class="op">&lt;</span> <span class="fl">100</span> <span class="op">~</span> <span class="va">this</span>,</span>
<span>  <span class="va">x</span> <span class="op">&lt;</span> <span class="fl">20</span> <span class="op">~</span> <span class="va">that</span>,</span>
<span>  .default <span class="op">=</span> <span class="va">default</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb32"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb32-1"><a href="#cb32-1" tabindex="-1"></a><span class="cf">CASE</span></span>
<span id="cb32-2"><a href="#cb32-2" tabindex="-1"></a>  <span class="cf">WHEN</span> x <span class="op">&lt;</span> <span class="dv">100</span> <span class="cf">THEN</span> this</span>
<span id="cb32-3"><a href="#cb32-3" tabindex="-1"></a>  <span class="cf">WHEN</span> x <span class="op">&lt;</span> <span class="dv">20</span> <span class="cf">THEN</span> that</span>
<span id="cb32-4"><a href="#cb32-4" tabindex="-1"></a>  <span class="cf">ELSE</span> <span class="kw">default</span></span>
<span id="cb32-5"><a href="#cb32-5" tabindex="-1"></a><span class="cf">END</span></span></code></pre></div>
<p>And dbplyr will translate a <code><a href="../reference/case-and-replace-when.html">case_when()</a></code> to this
form!</p>
<p><code><a href="../reference/recode-and-replace-values.html">recode_values()</a></code> is an R equivalent of SQL’s <a href="https://learn.microsoft.com/en-us/sql/t-sql/language-elements/case-transact-sql?view=sql-server-ver17#syntax" class="external-link">Simple
<code>CASE</code></a> statement:</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/recode-and-replace-values.html">recode_values</a></span><span class="op">(</span></span>
<span>  <span class="va">x</span>,</span>
<span>  <span class="st">"E"</span> <span class="op">~</span> <span class="st">"East"</span>,</span>
<span>  <span class="st">"W"</span> <span class="op">~</span> <span class="st">"West"</span>,</span>
<span>  <span class="st">"N"</span> <span class="op">~</span> <span class="st">"North"</span>,</span>
<span>  <span class="st">"S"</span> <span class="op">~</span> <span class="st">"South"</span>,</span>
<span>  .default <span class="op">=</span> <span class="st">"Unknown"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb34"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb34-1"><a href="#cb34-1" tabindex="-1"></a><span class="cf">CASE</span> x</span>
<span id="cb34-2"><a href="#cb34-2" tabindex="-1"></a>  <span class="cf">WHEN</span> <span class="st">'E'</span> <span class="cf">THEN</span> <span class="st">'East'</span></span>
<span id="cb34-3"><a href="#cb34-3" tabindex="-1"></a>  <span class="cf">WHEN</span> <span class="st">'W'</span> <span class="cf">THEN</span> <span class="st">'West'</span></span>
<span id="cb34-4"><a href="#cb34-4" tabindex="-1"></a>  <span class="cf">WHEN</span> <span class="st">'N'</span> <span class="cf">THEN</span> <span class="st">'North'</span></span>
<span id="cb34-5"><a href="#cb34-5" tabindex="-1"></a>  <span class="cf">WHEN</span> <span class="st">'S'</span> <span class="cf">THEN</span> <span class="st">'South'</span></span>
<span id="cb34-6"><a href="#cb34-6" tabindex="-1"></a>  <span class="cf">ELSE</span> <span class="st">'Unknown'</span></span>
<span id="cb34-7"><a href="#cb34-7" tabindex="-1"></a><span class="cf">END</span></span></code></pre></div>
<p>As of dbplyr 2.5.1, we don’t currently have a translation for
<code><a href="../reference/recode-and-replace-values.html">recode_values()</a></code> since it is so new, but we expect to have
one soon.</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



   </div>
  <footer><div class="container">
  <div class="pkgdown-footer-left">
  <p>Developed by <a href="https://hadley.nz" class="external-link">Hadley Wickham</a>, <a href="https://github.com/romainfrancois" class="external-link">Romain François</a>, <a href="https://github.com/lionel-" class="external-link">Lionel Henry</a>, <a href="https://krlmlr.info" class="external-link">Kirill Müller</a>, <a href="https://github.com/DavisVaughan" class="external-link">Davis Vaughan</a>, <a href="https://www.posit.co" class="external-link"><img src="https://www.tidyverse.org/posit-logo.svg" alt="Posit" height="16" width="62" style="margin-bottom: 3px;"></a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

  </div></footer>
</body>
</html>
