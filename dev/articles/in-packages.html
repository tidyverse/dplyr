<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="A guide for package authors who use dplyr.
">
<title>Using dplyr in packages • dplyr</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><link href="../deps/Source_Sans_Pro-0.4.7/font.css" rel="stylesheet">
<link href="../deps/Source_Code_Pro-0.4.7/font.css" rel="stylesheet">
<!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Using dplyr in packages">
<meta property="og:description" content="A guide for package authors who use dplyr.
">
<meta property="og:image" content="https://dplyr.tidyverse.org/logo.png">
<meta name="robots" content="noindex">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><script defer data-domain="dplyr.tidyverse.org,all.tidyverse.org" src="https://plausible.io/js/plausible.js"></script>
</head>
<body>
    <a href="#container" class="visually-hidden-focusable">Skip to content</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-none"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">dplyr</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">1.1.2.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../articles/dplyr.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/grouping.html">Grouped data</a>
    <a class="dropdown-item" href="../articles/two-table.html">Two-table verbs</a>
    <a class="dropdown-item" href="../articles/base.html">dplyr &lt;-&gt; base R</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Automation</h6>
    <a class="dropdown-item" href="../articles/colwise.html">Column-wise operations</a>
    <a class="dropdown-item" href="../articles/rowwise.html">Row-wise operations</a>
    <a class="dropdown-item" href="../articles/programming.html">Programming with dplyr</a>
    <div class="dropdown-divider"></div>
    <a class="dropdown-item" href="../articles/index.html">More articles...</a>
  </div>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-news">News</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-news">
    <h6 class="dropdown-header" data-toc-skip>Releases</h6>
    <a class="external-link dropdown-item" href="https://www.tidyverse.org/tags/dplyr-1-1-0/">Version 1.1.0</a>
    <a class="external-link dropdown-item" href="https://www.tidyverse.org/blog/2020/06/dplyr-1-0-0/">Version 1.0.0</a>
    <a class="external-link dropdown-item" href="https://www.tidyverse.org/articles/2019/07/dplyr-0-8-3/">Version 0.8.3</a>
    <a class="external-link dropdown-item" href="https://www.tidyverse.org/articles/2019/06/dplyr-0-8-2/">Version 0.8.2</a>
    <a class="external-link dropdown-item" href="https://www.tidyverse.org/articles/2019/05/dplyr-0-8-1/">Version 0.8.1</a>
    <a class="external-link dropdown-item" href="https://www.tidyverse.org/articles/2019/02/dplyr-0-8-0/">Version 0.8.0</a>
    <a class="external-link dropdown-item" href="https://www.tidyverse.org/articles/2018/06/dplyr-0.7.5/">Version 0.7.5</a>
    <div class="dropdown-divider"></div>
    <a class="dropdown-item" href="../news/index.html">Changelog</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/tidyverse/dplyr/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article" id="container">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Using dplyr in packages</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/tidyverse/dplyr/blob/HEAD/vignettes/in-packages.Rmd" class="external-link"><code>vignettes/in-packages.Rmd</code></a></small>
      <div class="d-none name"><code>in-packages.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span></span></code></pre></div>
<p>This vignette is aimed at package authors who use dplyr in their
packages. We will discuss best practices learned over the years to avoid
<code>R CMD check</code> notes and warnings, and how to handle when
dplyr deprecates functions.</p>
<div class="section level2">
<h2 id="join-helpers">Join helpers<a class="anchor" aria-label="anchor" href="#join-helpers"></a>
</h2>
<p>As of dplyr 1.1.0, we’ve introduced <code><a href="../reference/join_by.html">join_by()</a></code> along 4
helpers for performing various types of joins:</p>
<ul>
<li><p><code><a href="../reference/join_by.html">closest()</a></code></p></li>
<li><p><code><a href="../reference/between.html">between()</a></code></p></li>
<li><p><code><a href="../reference/join_by.html">within()</a></code></p></li>
<li><p><code><a href="../reference/join_by.html">overlaps()</a></code></p></li>
</ul>
<p><code><a href="../reference/join_by.html">join_by()</a></code> implements a domain specific language (DSL)
for joins, and internally interprets calls to these functions.</p>
<p>You’ll notice that <code><a href="../reference/join_by.html">dplyr::closest()</a></code> isn’t an exported
function from dplyr (<code><a href="../reference/between.html">dplyr::between()</a></code> and
<code><a href="https://rdrr.io/r/base/with.html" class="external-link">base::within()</a></code> do happen to be preexisting functions). If
you use <code><a href="../reference/join_by.html">closest()</a></code> in your package, then this will cause an
<code>R CMD check</code> note letting you know that you’ve used a symbol
that doesn’t belong to any package.</p>
<p>To silence this, place <code>utils::globalVariables("closest")</code>
in a source file in your package (but outside of any function). dbplyr
does a similar thing for SQL functions, so you can see an example of
that <a href="https://github.com/tidyverse/dbplyr/blob/7edf5d607fd6b0b897721ea96d1c9ca9401f0f9b/R/backend-redshift.R#L144" class="external-link">here</a>.</p>
<p>You may also have to add utils to your package Imports, even though
it is a base package. You can do that easily with
<code>usethis::use_package("utils")</code>.</p>
</div>
<div class="section level2">
<h2 id="data-masking-and-tidy-selection-notes">Data masking and tidy selection NOTEs<a class="anchor" aria-label="anchor" href="#data-masking-and-tidy-selection-notes"></a>
</h2>
<p>If you’re writing a package and you have a function that uses data
masking or tidy selection:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">my_summary_function</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>    <span class="fu"><a href="../reference/select.html">select</a></span><span class="op">(</span><span class="va">grp</span>, <span class="va">x</span>, <span class="va">y</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>    <span class="fu"><a href="../reference/filter.html">filter</a></span><span class="op">(</span><span class="va">x</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>    <span class="fu"><a href="../reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">grp</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>    <span class="fu"><a href="../reference/summarise.html">summarise</a></span><span class="op">(</span>y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span>, n <span class="op">=</span> <span class="fu"><a href="../reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>You’ll get an <code>NOTE</code> because <code>R CMD check</code>
doesn’t know that dplyr functions use tidy evaluation:</p>
<pre><code>N  checking R code for possible problems
   my_summary_function: no visible binding for global variable ‘grp’, ‘x’, ‘y’
   Undefined global functions or variables:
     grp x y</code></pre>
<p>To eliminate this note:</p>
<ul>
<li>For data masking, import <code>.data</code> from <a href="https://rlang.r-lib.org/" class="external-link">rlang</a> and then use
<code>.data$var</code> instead of <code>var</code>.</li>
<li>For tidy selection, use <code>"var"</code> instead of
<code>var</code>.</li>
</ul>
<p>That yields:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' @importFrom rlang .data</span></span>
<span><span class="va">my_summary_function</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>    <span class="fu"><a href="../reference/select.html">select</a></span><span class="op">(</span><span class="st">"grp"</span>, <span class="st">"x"</span>, <span class="st">"y"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>    <span class="fu"><a href="../reference/filter.html">filter</a></span><span class="op">(</span><span class="va">.data</span><span class="op">$</span><span class="va">x</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>    <span class="fu"><a href="../reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">.data</span><span class="op">$</span><span class="va">grp</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>    <span class="fu"><a href="../reference/summarise.html">summarise</a></span><span class="op">(</span>y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">.data</span><span class="op">$</span><span class="va">y</span><span class="op">)</span>, n <span class="op">=</span> <span class="fu"><a href="../reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>For more about programming with dplyr, see
<code><a href="../articles/programming.html">vignette("programming", package = "dplyr")</a></code>.</p>
</div>
<div class="section level2">
<h2 id="deprecation">Deprecation<a class="anchor" aria-label="anchor" href="#deprecation"></a>
</h2>
<p>This section is focused on updating package code to deal with
backwards incompatible changes in dplyr. We do try and minimize backward
incompatible changes as much as possible, but sometimes they are
necessary in order to radically simplify existing code, or unlock a lot
of potential value in the future.</p>
<p>We will start with some general advice about supporting multiple
versions of dplyr at once, and then we will discuss some specific
changes in dplyr.</p>
<div class="section level3">
<h3 id="multiple-dplyr-versions">Multiple dplyr versions<a class="anchor" aria-label="anchor" href="#multiple-dplyr-versions"></a>
</h3>
<p>Ideally, when we introduce a breaking change you’ll want to make sure
that your package works with both the released version and the
development version of dplyr. This is typically a little bit more work,
but has two big advantages:</p>
<ul>
<li><p>It’s more convenient for your users, since your package will work
for them regardless of what version of dplyr they have
installed.</p></li>
<li><p>It’s easier on CRAN since it doesn’t require a massive
coordinated release of multiple packages.</p></li>
</ul>
<p>If we break your package, we will typically send you a pull request
that implements a patch before releasing the next version of dplyr. Most
of the time, this patch will be backwards compatible with older versions
of dplyr as well. Ideally, you’ll accept this patch and submit a new
version of your package to CRAN before the new version of dplyr is
released.</p>
<p>To make code work with multiple versions of a package, your first
tool is the simple if statement:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">if</span> <span class="op">(</span><span class="fu">utils</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/utils/packageDescription.html" class="external-link">packageVersion</a></span><span class="op">(</span><span class="st">"dplyr"</span><span class="op">)</span> <span class="op">&gt;</span> <span class="st">"0.5.0"</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># code for new version</span></span>
<span><span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>  <span class="co"># code for old version</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Always condition on <code>&gt; current-version</code>, not
<code>&gt;= next-version</code> because this will ensure that this
branch is also used for the development version of the package. For
example, if the current release is version <code>"0.5.0"</code>, the
development version will be <code>"0.5.0.9000"</code>.</p>
<p>This typically works well if the branch for the “new version”
introduces a new argument or has a slightly different return value.</p>
<p>This <em>doesn’t</em> work if we’ve introduced a new function that
you need to switch to, like:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">if</span> <span class="op">(</span><span class="fu">utils</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/utils/packageDescription.html" class="external-link">packageVersion</a></span><span class="op">(</span><span class="st">"dplyr"</span><span class="op">)</span> <span class="op">&gt;</span> <span class="st">"1.0.10"</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="../reference/reframe.html">reframe</a></span><span class="op">(</span><span class="va">df</span>, x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="../reference/summarise.html">summarise</a></span><span class="op">(</span><span class="va">df</span>, x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>In this case, when checks are run with dplyr 1.0.10 you’ll get a
warning about using a function from dplyr that doesn’t exist
(<code><a href="../reference/reframe.html">reframe()</a></code>) even though that branch will never run. You can
get around this by using <code><a href="https://rdrr.io/r/utils/getFromNamespace.html" class="external-link">utils::getFromNamespace()</a></code> to
indirectly call the new dplyr function:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">if</span> <span class="op">(</span><span class="fu">utils</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/utils/packageDescription.html" class="external-link">packageVersion</a></span><span class="op">(</span><span class="st">"dplyr"</span><span class="op">)</span> <span class="op">&gt;</span> <span class="st">"1.0.10"</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu">utils</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/utils/getFromNamespace.html" class="external-link">getFromNamespace</a></span><span class="op">(</span><span class="st">"reframe"</span>, <span class="st">"dplyr"</span><span class="op">)</span><span class="op">(</span><span class="va">df</span>, x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="../reference/summarise.html">summarise</a></span><span class="op">(</span><span class="va">df</span>, x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>As soon as the next version of dplyr is actually on CRAN (1.1.0 in
this case), you should feel free to remove this code and unconditionally
use <code><a href="../reference/reframe.html">reframe()</a></code> as long as you also require
<code>dplyr (&gt;= 1.1.0)</code> in your <code>DESCRIPTION</code> file.
This is typically not very painful for users, because they’d already be
updating your package when they run into this requirement, so updating
one more package along the way is generally easy. It also helps them get
the latest bug fixes and features from dplyr.</p>
<p>Sometimes, it isn’t possible to avoid a call to
<code>@importFrom</code>. For example you might be importing a generic
so that you can define a method for it, but that generic has moved
between packages. In this case, you can take advantage of a little-known
feature in the <code>NAMESPACE</code> file: you can include raw
<code>if</code> statements.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' @rawNamespace</span></span>
<span><span class="co">#' if (utils::packageVersion("dplyr") &gt; "0.5.0") {</span></span>
<span><span class="co">#'   importFrom("dbplyr", "build_sql")</span></span>
<span><span class="co">#' } else {</span></span>
<span><span class="co">#'   importFrom("dplyr", "build_sql")</span></span>
<span><span class="co">#' }</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="deprecation-of-mutate_-and-summarise_">Deprecation of <code>mutate_*()</code> and
<code>summarise_*()</code><a class="anchor" aria-label="anchor" href="#deprecation-of-mutate_-and-summarise_"></a>
</h3>
<p>The following <code><a href="../reference/mutate.html">mutate()</a></code> and <code><a href="../reference/summarise.html">summarise()</a></code>
variants were deprecated in dplyr 0.7.0:</p>
<ul>
<li>
<code><a href="../reference/summarise_each.html">mutate_each()</a></code>, <code><a href="../reference/summarise_each.html">summarise_each()</a></code>
</li>
</ul>
<p>and the following variants were superseded in dplyr 1.0.0:</p>
<ul>
<li><p><code><a href="../reference/mutate_all.html">mutate_all()</a></code>, <code><a href="../reference/summarise_all.html">summarise_all()</a></code></p></li>
<li><p><code><a href="../reference/mutate_all.html">mutate_if()</a></code>, <code><a href="../reference/summarise_all.html">summarise_if()</a></code></p></li>
<li><p><code><a href="../reference/mutate_all.html">mutate_at()</a></code>, <code><a href="../reference/summarise_all.html">summarise_at()</a></code></p></li>
</ul>
<p>These have all been replaced by using <code><a href="../reference/mutate.html">mutate()</a></code> or
<code><a href="../reference/summarise.html">summarise()</a></code> in combination with <code><a href="../reference/across.html">across()</a></code>,
which was introduced in dplyr 1.0.0.</p>
<p>If you used <code><a href="../reference/mutate_all.html">mutate_all()</a></code> or <code><a href="../reference/summarise_each.html">mutate_each()</a></code>
without supplying a selection, you should update to use
<code>across(everything())</code>:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">starwars</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="../reference/summarise_each.html">mutate_each</a></span><span class="op">(</span><span class="fu"><a href="../reference/funs.html">funs</a></span><span class="op">(</span><span class="va">as.character</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">starwars</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="../reference/mutate_all.html">mutate_all</a></span><span class="op">(</span><span class="fu"><a href="../reference/funs.html">funs</a></span><span class="op">(</span><span class="va">as.character</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">starwars</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="../reference/mutate.html">mutate</a></span><span class="op">(</span><span class="fu"><a href="../reference/across.html">across</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html" class="external-link">everything</a></span><span class="op">(</span><span class="op">)</span>, <span class="va">as.character</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>If you provided a selection through <code><a href="../reference/mutate_all.html">mutate_at()</a></code> or
<code><a href="../reference/summarise_each.html">mutate_each()</a></code>, then you can switch to <code><a href="../reference/across.html">across()</a></code>
with a selection:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">starwars</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="../reference/summarise_each.html">mutate_each</a></span><span class="op">(</span><span class="fu"><a href="../reference/funs.html">funs</a></span><span class="op">(</span><span class="va">as.character</span><span class="op">)</span>, <span class="va">height</span>, <span class="va">mass</span><span class="op">)</span></span>
<span><span class="va">starwars</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="../reference/mutate_all.html">mutate_at</a></span><span class="op">(</span><span class="fu"><a href="../reference/vars.html">vars</a></span><span class="op">(</span><span class="va">height</span>, <span class="va">mass</span><span class="op">)</span>, <span class="va">as.character</span><span class="op">)</span></span>
<span><span class="va">starwars</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="../reference/mutate.html">mutate</a></span><span class="op">(</span><span class="fu"><a href="../reference/across.html">across</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">height</span>, <span class="va">mass</span><span class="op">)</span>, <span class="va">as.character</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>If you used predicates with <code><a href="../reference/mutate_all.html">mutate_if()</a></code>, you can switch
to using <code><a href="../reference/across.html">across()</a></code> in combination with
<code><a href="https://tidyselect.r-lib.org/reference/where.html" class="external-link">where()</a></code>:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">starwars</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="../reference/mutate_all.html">mutate_if</a></span><span class="op">(</span><span class="va">is.factor</span>, <span class="va">as.character</span><span class="op">)</span></span>
<span><span class="va">starwars</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="../reference/mutate.html">mutate</a></span><span class="op">(</span><span class="fu"><a href="../reference/across.html">across</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/where.html" class="external-link">where</a></span><span class="op">(</span><span class="va">is.factor</span><span class="op">)</span>, <span class="va">as.character</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="data-frame-subclasses">Data frame subclasses<a class="anchor" aria-label="anchor" href="#data-frame-subclasses"></a>
</h2>
<p>If you are a package author that is <em>extending</em> dplyr to work
with a new data frame subclass, then we encourage you to read the
documentation in <code><a href="../reference/dplyr_extending.html">?dplyr_extending</a></code>. This contains advice on
how to implement the minimal number of extension generics possible to
get maximal compatibility across dplyr’s verbs.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



   </div>
  <footer><div class="container">
  <div class="pkgdown-footer-left">
  <p></p>
<p>Developed by <a href="http://hadley.nz" class="external-link">Hadley Wickham</a>, <a href="https://github.com/romainfrancois" class="external-link">Romain François</a>, <a href="https://github.com/lionel-" class="external-link">Lionel Henry</a>, <a href="https://krlmlr.info" class="external-link">Kirill Müller</a>, <a href="https://github.com/DavisVaughan" class="external-link">Davis Vaughan</a>, <a href="https://www.posit.co" class="external-link"><img src="https://www.tidyverse.org/posit-logo.svg" alt="Posit" height="16" style="margin-bottom: 3px;"></a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

  </div></footer>
</body>
</html>
