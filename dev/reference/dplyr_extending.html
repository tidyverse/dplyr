<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Extending dplyr with new data frame subclasses — dplyr_extending • dplyr</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Source_Sans_Pro-0.4.9/font.css" rel="stylesheet"><link href="../deps/Source_Code_Pro-0.4.9/font.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Extending dplyr with new data frame subclasses — dplyr_extending"><meta name="description" content="
These three functions, along with names&amp;lt;- and 1d numeric [
(i.e. x[loc]) methods, provide a minimal interface for extending dplyr
to work with new data frame subclasses. This means that for simple cases
you should only need to provide a couple of methods, rather than a method
for every dplyr verb.
These functions are a stop-gap measure until we figure out how to solve
the problem more generally, but it's likely that any code you write to
implement them will find a home in what comes next."><meta property="og:description" content="
These three functions, along with names&amp;lt;- and 1d numeric [
(i.e. x[loc]) methods, provide a minimal interface for extending dplyr
to work with new data frame subclasses. This means that for simple cases
you should only need to provide a couple of methods, rather than a method
for every dplyr verb.
These functions are a stop-gap measure until we figure out how to solve
the problem more generally, but it's likely that any code you write to
implement them will find a home in what comes next."><meta property="og:image" content="https://dplyr.tidyverse.org/logo.png"><meta name="robots" content="noindex"><script defer data-domain="dplyr.tidyverse.org,all.tidyverse.org" src="https://plausible.io/js/plausible.js"></script></head><body>
    <a href="#container" class="visually-hidden-focusable">Skip to content</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-none" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">dplyr</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">1.1.4.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/dplyr.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/grouping.html">Grouped data</a></li>
    <li><a class="dropdown-item" href="../articles/two-table.html">Two-table verbs</a></li>
    <li><a class="dropdown-item" href="../articles/base.html">dplyr &lt;-&gt; base R</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Automation</h6></li>
    <li><a class="dropdown-item" href="../articles/colwise.html">Column-wise operations</a></li>
    <li><a class="dropdown-item" href="../articles/rowwise.html">Row-wise operations</a></li>
    <li><a class="dropdown-item" href="../articles/programming.html">Programming with dplyr</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../articles/index.html">More articles...</a></li>
  </ul></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-news" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">News</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-news"><li><h6 class="dropdown-header" data-toc-skip>Releases</h6></li>
    <li><a class="external-link dropdown-item" href="https://www.tidyverse.org/tags/dplyr-1-1-0/">Version 1.1.0</a></li>
    <li><a class="external-link dropdown-item" href="https://www.tidyverse.org/blog/2020/06/dplyr-1-0-0/">Version 1.0.0</a></li>
    <li><a class="external-link dropdown-item" href="https://www.tidyverse.org/articles/2019/07/dplyr-0-8-3/">Version 0.8.3</a></li>
    <li><a class="external-link dropdown-item" href="https://www.tidyverse.org/articles/2019/06/dplyr-0-8-2/">Version 0.8.2</a></li>
    <li><a class="external-link dropdown-item" href="https://www.tidyverse.org/articles/2019/05/dplyr-0-8-1/">Version 0.8.1</a></li>
    <li><a class="external-link dropdown-item" href="https://www.tidyverse.org/articles/2019/02/dplyr-0-8-0/">Version 0.8.0</a></li>
    <li><a class="external-link dropdown-item" href="https://www.tidyverse.org/articles/2018/06/dplyr-0.7.5/">Version 0.7.5</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../news/index.html">Changelog</a></li>
  </ul></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/tidyverse/dplyr/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic" id="container">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Extending dplyr with new data frame subclasses</h1>
      <small class="dont-index">Source: <a href="https://github.com/tidyverse/dplyr/blob/main/R/generics.R" class="external-link"><code>R/generics.R</code></a></small>
      <div class="d-none name"><code>dplyr_extending.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p><a href="https://lifecycle.r-lib.org/articles/stages.html#experimental" class="external-link"><img src="figures/lifecycle-experimental.svg" alt="[Experimental]"></a></p>
<p>These three functions, along with <code>names&lt;-</code> and 1d numeric <code>[</code>
(i.e. <code>x[loc]</code>) methods, provide a minimal interface for extending dplyr
to work with new data frame subclasses. This means that for simple cases
you should only need to provide a couple of methods, rather than a method
for every dplyr verb.</p>
<p>These functions are a stop-gap measure until we figure out how to solve
the problem more generally, but it's likely that any code you write to
implement them will find a home in what comes next.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">dplyr_row_slice</span><span class="op">(</span><span class="va">data</span>, <span class="va">i</span>, <span class="va">...</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">dplyr_col_modify</span><span class="op">(</span><span class="va">data</span>, <span class="va">cols</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">dplyr_reconstruct</span><span class="op">(</span><span class="va">data</span>, <span class="va">template</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-data">data<a class="anchor" aria-label="anchor" href="#arg-data"></a></dt>
<dd><p>A tibble. We use tibbles because they avoid some inconsistent
subset-assignment use cases.</p></dd>


<dt id="arg-i">i<a class="anchor" aria-label="anchor" href="#arg-i"></a></dt>
<dd><p>A numeric or logical vector that indexes the rows of <code>data</code>.</p></dd>


<dt id="arg-cols">cols<a class="anchor" aria-label="anchor" href="#arg-cols"></a></dt>
<dd><p>A named list used to modify columns. A <code>NULL</code> value should remove
an existing column.</p></dd>


<dt id="arg-template">template<a class="anchor" aria-label="anchor" href="#arg-template"></a></dt>
<dd><p>Template data frame to use for restoring attributes.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="basic-advice">Basic advice<a class="anchor" aria-label="anchor" href="#basic-advice"></a></h2>
    <p>This section gives you basic advice if you want to extend dplyr to work with
your custom data frame subclass, and you want the dplyr methods to behave
in basically the same way.</p><ul><li><p>If you have data frame attributes that don't depend on the rows or columns
(and should unconditionally be preserved), you don't need to do anything.
The one exception to this is if your subclass extends a data.frame
directly rather than extending a tibble. The <code>[.data.frame</code> method does not
preserve attributes, so you'll need to write a <code>[</code> method for your subclass
that preserves attributes important for your class.</p></li>
<li><p>If you have <strong>scalar</strong> attributes that depend on <strong>rows</strong>, implement a
<code>dplyr_reconstruct()</code> method. Your method should recompute the attribute
depending on rows now present.</p></li>
<li><p>If you have <strong>scalar</strong> attributes that depend on <strong>columns</strong>, implement a
<code>dplyr_reconstruct()</code> method and a 1d <code>[</code> method. For example, if your
class requires that certain columns be present, your method should return
a data.frame or tibble when those columns are removed.</p></li>
<li><p>If your attributes are <strong>vectorised</strong> over <strong>rows</strong>, implement a
<code>dplyr_row_slice()</code> method. This gives you access to <code>i</code> so you can
modify the row attribute accordingly. You'll also need to think carefully
about how to recompute the attribute in <code>dplyr_reconstruct()</code>, and
you will need to carefully verify the behaviour of each verb, and provide
additional methods as needed.</p></li>
<li><p>If your attributes that are <strong>vectorised</strong> over <strong>columns</strong>, implement
<code>dplyr_col_modify()</code>, 1d <code>[</code>, and <code>names&lt;-</code> methods. All of these methods
know which columns are being modified, so you can update the column
attribute according. You'll also need to think carefully about how to
recompute the attribute in <code>dplyr_reconstruct()</code>, and you will need to
carefully verify the behaviour of each verb, and provide additional
methods as needed.</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="current-usage">Current usage<a class="anchor" aria-label="anchor" href="#current-usage"></a></h2>

<ul><li><p><code><a href="arrange.html">arrange()</a></code>, <code><a href="filter.html">filter()</a></code>, <code><a href="slice.html">slice()</a></code> (and the rest of the <code>slice_*()</code>
family), <code><a href="filter-joins.html">semi_join()</a></code>, and <code><a href="filter-joins.html">anti_join()</a></code> work by generating a vector of
row indices, and then subsetting with <code>dplyr_row_slice()</code>.</p></li>
<li><p><code><a href="mutate.html">mutate()</a></code> generates a list of new column value (using <code>NULL</code> to indicate
when columns should be deleted), then passes that to <code>dplyr_col_modify()</code>.
It also uses 1d <code>[</code> to implement <code>.keep</code>, and will call <code><a href="relocate.html">relocate()</a></code> if
either <code>.before</code> or <code>.after</code> are supplied.</p></li>
<li><p><code><a href="summarise.html">summarise()</a></code> and <code><a href="reframe.html">reframe()</a></code> work similarly to <code><a href="mutate.html">mutate()</a></code> but the data
modified by <code>dplyr_col_modify()</code> comes from <code><a href="group_data.html">group_data()</a></code> or is built
from <code>.by</code>. Note that this means that the data frames returned by
<code><a href="summarise.html">summarise()</a></code> and <code><a href="reframe.html">reframe()</a></code> are fundamentally new data frames, and
will not retain any custom subclasses or attributes.</p></li>
<li><p><code><a href="select.html">select()</a></code> uses 1d <code>[</code> to select columns, then <code>names&lt;-</code> to rename them.
<code><a href="rename.html">rename()</a></code> just uses <code>names&lt;-</code>. <code><a href="relocate.html">relocate()</a></code> just uses 1d <code>[</code>.</p></li>
<li><p><code><a href="mutate-joins.html">inner_join()</a></code>, <code><a href="mutate-joins.html">left_join()</a></code>, <code><a href="mutate-joins.html">right_join()</a></code>, and <code><a href="mutate-joins.html">full_join()</a></code>
coerce <code>x</code> to a tibble, modify the rows, then use <code>dplyr_reconstruct()</code>
to convert back to the same type as <code>x</code>.</p></li>
<li><p><code><a href="nest_join.html">nest_join()</a></code> converts both <code>x</code> and <code>y</code> to tibbles, modifies the rows,
and uses <code>dplyr_col_modify()</code> to handle modified key variables and the
list-column that <code>y</code> becomes. It also uses <code>dplyr_reconstruct()</code> to convert
the outer result back to the type of <code>x</code>, and to convert the nested tibbles
back to the type of <code>y</code>.</p></li>
<li><p><code><a href="distinct.html">distinct()</a></code> does a <code><a href="mutate.html">mutate()</a></code> if any expressions are present, then
uses 1d <code>[</code> to select variables to keep, then <code>dplyr_row_slice()</code> to
select distinct rows.</p></li>
</ul><p>Note that <code><a href="group_by.html">group_by()</a></code> and <code><a href="group_by.html">ungroup()</a></code> don't use any of these generics and
you'll need to provide methods for them directly, or rely on <code>.by</code> for
per-operation grouping.</p>
    </div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


   </div>
  <footer><div class="container">
  <div class="pkgdown-footer-left">
  <p>Developed by <a href="https://hadley.nz" class="external-link">Hadley Wickham</a>, <a href="https://github.com/romainfrancois" class="external-link">Romain François</a>, <a href="https://github.com/lionel-" class="external-link">Lionel Henry</a>, <a href="https://krlmlr.info" class="external-link">Kirill Müller</a>, <a href="https://github.com/DavisVaughan" class="external-link">Davis Vaughan</a>, <a href="https://www.posit.co" class="external-link"><img src="https://www.tidyverse.org/posit-logo.svg" alt="Posit" height="16" width="62" style="margin-bottom: 3px;"></a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

  </div></footer></body></html>

