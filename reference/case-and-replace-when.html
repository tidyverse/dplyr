<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>A general vectorised if-else — case-and-replace-when • dplyr</title><!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png"><link rel="icon" type="”image/svg+xml”" href="../favicon.svg"><link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png"><link rel="icon" sizes="any" href="../favicon.ico"><link rel="manifest" href="../site.webmanifest"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Source_Sans_Pro-0.4.10/font.css" rel="stylesheet"><link href="../deps/Source_Code_Pro-0.4.10/font.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="A general vectorised if-else — case-and-replace-when"><meta name="description" content='case_when() and replace_when() are two forms of vectorized if_else().
They work by evaluating each case sequentially and using the first match for
each element to determine the corresponding value in the output vector.
Use case_when() when creating an entirely new vector.
Use replace_when() when partially updating an existing vector.


If you are just replacing a few values within an existing vector, then
replace_when() is always a better choice because it is type stable, size
stable, pipes better, and better expresses intent.
A major difference between the two functions is what happens when no cases
match:
case_when() falls through to a .default as a final "else" statement.
replace_when() retains the original values from x.


See vignette("recoding-replacing") for more examples.'><meta property="og:description" content='case_when() and replace_when() are two forms of vectorized if_else().
They work by evaluating each case sequentially and using the first match for
each element to determine the corresponding value in the output vector.
Use case_when() when creating an entirely new vector.
Use replace_when() when partially updating an existing vector.


If you are just replacing a few values within an existing vector, then
replace_when() is always a better choice because it is type stable, size
stable, pipes better, and better expresses intent.
A major difference between the two functions is what happens when no cases
match:
case_when() falls through to a .default as a final "else" statement.
replace_when() retains the original values from x.


See vignette("recoding-replacing") for more examples.'><meta property="og:image" content="https://dplyr.tidyverse.org/logo.png"><script src="https://cdn.jsdelivr.net/gh/posit-dev/supported-by-posit/js/badge.min.js" data-max-height="43" data-hide-below="1200" data-light-bg="#666f76" data-light-fg="#f9f9f9"></script><script defer data-domain="dplyr.tidyverse.org,all.tidyverse.org" src="https://plausible.io/js/plausible.js"></script><script async src="https://widget.kapa.ai/kapa-widget.bundle.js" data-button-hide="true" data-modal-disclaimer="This is a custom LLM for answering questions about dplyr, tidyr, and ggplot2. Answers are based on the contents of the documentation. Rate the answers to let us know what you think!" data-modal-ask-ai-input-placeholder="Ask me a question about dplyr, tidyr, or ggplot2." data-modal-header-bg-color="#f9f9f9" data-modal-override-open-class="open-kapa-widget" data-project-color="#365a7a" data-project-name="dplyr" data-modal-title="tidyverse AI ✨" data-project-logo="https://avatars.githubusercontent.com/u/22032646?s=200&amp;u=235532df5cf8543246812f73db051b793f868807&amp;v=4" data-user-analytics-fingerprint-enabled="true" data-bot-protection-mechanism="hcaptcha" data-website-id="44ae76c6-2ae5-4899-ab42-de9f17f07c7b"></script></head><body>
    <a href="#container" class="visually-hidden-focusable">Skip to content</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-none" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">dplyr</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">1.2.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/dplyr.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/grouping.html">Grouped data</a></li>
    <li><a class="dropdown-item" href="../articles/two-table.html">Two-table verbs</a></li>
    <li><a class="dropdown-item" href="../articles/recoding-replacing.html">Recoding columns and replacing values</a></li>
    <li><a class="dropdown-item" href="../articles/base.html">dplyr &lt;-&gt; base R</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Automation</h6></li>
    <li><a class="dropdown-item" href="../articles/colwise.html">Column-wise operations</a></li>
    <li><a class="dropdown-item" href="../articles/rowwise.html">Row-wise operations</a></li>
    <li><a class="dropdown-item" href="../articles/programming.html">Programming with dplyr</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../articles/index.html">More articles...</a></li>
  </ul></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-news" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">News</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-news"><li><h6 class="dropdown-header" data-toc-skip>Releases</h6></li>
    <li><a class="external-link dropdown-item" href="https://tidyverse.org/blog/2026/02/dplyr-1-2-0/">Version 1.2.0</a></li>
    <li><a class="external-link dropdown-item" href="https://www.tidyverse.org/tags/dplyr-1-1-0/">Version 1.1.0</a></li>
    <li><a class="external-link dropdown-item" href="https://www.tidyverse.org/blog/2020/06/dplyr-1-0-0/">Version 1.0.0</a></li>
    <li><a class="external-link dropdown-item" href="https://www.tidyverse.org/blog/2019/07/dplyr-0-8-3/">Version 0.8.3</a></li>
    <li><a class="external-link dropdown-item" href="https://www.tidyverse.org/blog/2019/06/dplyr-0-8-2/">Version 0.8.2</a></li>
    <li><a class="external-link dropdown-item" href="https://www.tidyverse.org/blog/2019/05/dplyr-0-8-1/">Version 0.8.1</a></li>
    <li><a class="external-link dropdown-item" href="https://www.tidyverse.org/blog/2019/02/dplyr-0-8-0/">Version 0.8.0</a></li>
    <li><a class="external-link dropdown-item" href="https://www.tidyverse.org/blog/2018/06/dplyr-0.7.5/">Version 0.7.5</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../news/index.html">Changelog</a></li>
  </ul></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/tidyverse/dplyr/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item"><a class="nav-link open-kapa-widget" href="../#">Ask AI ✨</a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic" id="container">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>A general vectorised if-else</h1>
      <small class="dont-index">Source: <a href="https://github.com/tidyverse/dplyr/blob/main/R/case-when.R" class="external-link"><code>R/case-when.R</code></a></small>
      <div class="d-none name"><code>case-and-replace-when.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p><code>case_when()</code> and <code>replace_when()</code> are two forms of vectorized <code><a href="if_else.html">if_else()</a></code>.
They work by evaluating each case sequentially and using the first match for
each element to determine the corresponding value in the output vector.</p><ul><li><p>Use <code>case_when()</code> when creating an entirely new vector.</p></li>
<li><p>Use <code>replace_when()</code> when partially updating an existing vector.</p></li>
</ul><p>If you are just replacing a few values within an existing vector, then
<code>replace_when()</code> is always a better choice because it is type stable, size
stable, pipes better, and better expresses intent.</p>
<p>A major difference between the two functions is what happens when no cases
match:</p><ul><li><p><code>case_when()</code> falls through to a <code>.default</code> as a final "else" statement.</p></li>
<li><p><code>replace_when()</code> retains the original values from <code>x</code>.</p></li>
</ul><p>See <code><a href="../articles/recoding-replacing.html">vignette("recoding-replacing")</a></code> for more examples.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">case_when</span><span class="op">(</span></span>
<span>  <span class="va">...</span>,</span>
<span>  .default <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  .unmatched <span class="op">=</span> <span class="st">"default"</span>,</span>
<span>  .ptype <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  .size <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">replace_when</span><span class="op">(</span><span class="va">x</span>, <span class="va">...</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>&lt;<code><a href="https://rlang.r-lib.org/reference/dyn-dots.html" class="external-link">dynamic-dots</a></code>&gt; A sequence of two-sided
formulas. The left hand side (LHS) determines which values match this case.
The right hand side (RHS) provides the replacement value.</p>
<p>For <code>case_when()</code>:</p><ul><li><p>The LHS inputs must be logical vectors. For backwards compatibility,
scalars are <a href="https://vctrs.r-lib.org/reference/theory-faq-recycling.html" class="external-link">recycled</a>, but we no longer
recommend supplying scalars.</p></li>
<li><p>The RHS inputs will be <a href="https://vctrs.r-lib.org/reference/theory-faq-coercion.html" class="external-link">cast</a> to their common
type, and will be <a href="https://vctrs.r-lib.org/reference/theory-faq-recycling.html" class="external-link">recycled</a> to the common
size of the LHS inputs.</p></li>
</ul><p>For <code>replace_when()</code>:</p><ul><li><p>The LHS inputs must be logical vectors the same size as <code>x</code>.</p></li>
<li><p>The RHS inputs will be <a href="https://vctrs.r-lib.org/reference/theory-faq-coercion.html" class="external-link">cast</a> to the type of
<code>x</code> and <a href="https://vctrs.r-lib.org/reference/theory-faq-recycling.html" class="external-link">recycled</a> to the size of <code>x</code>.</p></li>
</ul><p><code>NULL</code> inputs are ignored.</p></dd>


<dt id="arg--default">.default<a class="anchor" aria-label="anchor" href="#arg--default"></a></dt>
<dd><p>The value used when all of the LHS inputs return either
<code>FALSE</code> or <code>NA</code>.</p><ul><li><p>If <code>NULL</code>, the default, a missing value will be used.</p></li>
<li><p>If provided, <code>.default</code> will follow the same type and size rules as the
RHS inputs.</p></li>
</ul><p><code>NA</code> values in the LHS conditions are treated like <code>FALSE</code>, meaning that
the result at those locations will be assigned the <code>.default</code> value. To
handle missing values in the conditions differently, you must explicitly
catch them with another condition before they fall through to the
<code>.default</code>. This typically involves some variation of <code>is.na(x) ~ value</code>
tailored to your usage of <code>case_when()</code>.</p></dd>


<dt id="arg--unmatched">.unmatched<a class="anchor" aria-label="anchor" href="#arg--unmatched"></a></dt>
<dd><p>Handling of unmatched locations.</p>
<p>One of:</p><ul><li><p><code>"default"</code> to use <code>.default</code> in unmatched locations.</p></li>
<li><p><code>"error"</code> to error when there are unmatched locations.</p></li>
</ul></dd>


<dt id="arg--ptype">.ptype<a class="anchor" aria-label="anchor" href="#arg--ptype"></a></dt>
<dd><p>An optional prototype declaring the desired output type. If
supplied, this overrides the common type of the RHS inputs.</p></dd>


<dt id="arg--size">.size<a class="anchor" aria-label="anchor" href="#arg--size"></a></dt>
<dd><p>An optional size declaring the desired output size. If supplied,
this overrides the common size computed from the LHS inputs.</p></dd>


<dt id="arg-x">x<a class="anchor" aria-label="anchor" href="#arg-x"></a></dt>
<dd><p>A vector.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>For <code>case_when()</code>, a new vector where the size is the common size of the LHS
inputs, the type is the common type of the RHS inputs, and the names
correspond to the names of the RHS elements used in the result.</p>
<p>For <code>replace_when()</code>, an updated version of <code>x</code>, with the same size, type,
and names as <code>x</code>.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="recode-and-replace-values.html">recode_values()</a></code>, <code><a href="https://vctrs.r-lib.org/reference/vec-case-and-replace.html" class="external-link">vctrs::vec_case_when()</a></code></p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="fl">70</span></span></span>
<span class="r-in"><span><span class="fu">case_when</span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">x</span> <span class="op"><a href="https://rdrr.io/r/base/Arithmetic.html" class="external-link">%%</a></span> <span class="fl">35</span> <span class="op">==</span> <span class="fl">0</span> <span class="op">~</span> <span class="st">"fizz buzz"</span>,</span></span>
<span class="r-in"><span>  <span class="va">x</span> <span class="op"><a href="https://rdrr.io/r/base/Arithmetic.html" class="external-link">%%</a></span> <span class="fl">5</span> <span class="op">==</span> <span class="fl">0</span> <span class="op">~</span> <span class="st">"fizz"</span>,</span></span>
<span class="r-in"><span>  <span class="va">x</span> <span class="op"><a href="https://rdrr.io/r/base/Arithmetic.html" class="external-link">%%</a></span> <span class="fl">7</span> <span class="op">==</span> <span class="fl">0</span> <span class="op">~</span> <span class="st">"buzz"</span>,</span></span>
<span class="r-in"><span>  .default <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [1] "1"         "2"         "3"         "4"         "fizz"     </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [6] "6"         "buzz"      "8"         "9"         "fizz"     </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [11] "11"        "12"        "13"        "buzz"      "fizz"     </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [16] "16"        "17"        "18"        "19"        "fizz"     </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [21] "buzz"      "22"        "23"        "24"        "fizz"     </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [26] "26"        "27"        "buzz"      "29"        "fizz"     </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [31] "31"        "32"        "33"        "34"        "fizz buzz"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [36] "36"        "37"        "38"        "39"        "fizz"     </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [41] "41"        "buzz"      "43"        "44"        "fizz"     </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [46] "46"        "47"        "48"        "buzz"      "fizz"     </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [51] "51"        "52"        "53"        "54"        "fizz"     </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [56] "buzz"      "57"        "58"        "59"        "fizz"     </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [61] "61"        "62"        "buzz"      "64"        "fizz"     </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [66] "66"        "67"        "68"        "69"        "fizz buzz"</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Like an if statement, the arguments are evaluated in order, so you must</span></span></span>
<span class="r-in"><span><span class="co"># proceed from the most specific to the most general. This won't work:</span></span></span>
<span class="r-in"><span><span class="fu">case_when</span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">x</span> <span class="op"><a href="https://rdrr.io/r/base/Arithmetic.html" class="external-link">%%</a></span> <span class="fl">5</span> <span class="op">==</span> <span class="fl">0</span> <span class="op">~</span> <span class="st">"fizz"</span>,</span></span>
<span class="r-in"><span>  <span class="va">x</span> <span class="op"><a href="https://rdrr.io/r/base/Arithmetic.html" class="external-link">%%</a></span> <span class="fl">7</span> <span class="op">==</span> <span class="fl">0</span> <span class="op">~</span> <span class="st">"buzz"</span>,</span></span>
<span class="r-in"><span>  <span class="va">x</span> <span class="op"><a href="https://rdrr.io/r/base/Arithmetic.html" class="external-link">%%</a></span> <span class="fl">35</span> <span class="op">==</span> <span class="fl">0</span> <span class="op">~</span> <span class="st">"fizz buzz"</span>,</span></span>
<span class="r-in"><span>  .default <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [1] "1"    "2"    "3"    "4"    "fizz" "6"    "buzz" "8"    "9"   </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [10] "fizz" "11"   "12"   "13"   "buzz" "fizz" "16"   "17"   "18"  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [19] "19"   "fizz" "buzz" "22"   "23"   "24"   "fizz" "26"   "27"  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [28] "buzz" "29"   "fizz" "31"   "32"   "33"   "34"   "fizz" "36"  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [37] "37"   "38"   "39"   "fizz" "41"   "buzz" "43"   "44"   "fizz"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [46] "46"   "47"   "48"   "buzz" "fizz" "51"   "52"   "53"   "54"  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [55] "fizz" "buzz" "57"   "58"   "59"   "fizz" "61"   "62"   "buzz"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [64] "64"   "fizz" "66"   "67"   "68"   "69"   "fizz"</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># If none of the cases match and no `.default` is supplied, NA is used:</span></span></span>
<span class="r-in"><span><span class="fu">case_when</span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">x</span> <span class="op"><a href="https://rdrr.io/r/base/Arithmetic.html" class="external-link">%%</a></span> <span class="fl">35</span> <span class="op">==</span> <span class="fl">0</span> <span class="op">~</span> <span class="st">"fizz buzz"</span>,</span></span>
<span class="r-in"><span>  <span class="va">x</span> <span class="op"><a href="https://rdrr.io/r/base/Arithmetic.html" class="external-link">%%</a></span> <span class="fl">5</span> <span class="op">==</span> <span class="fl">0</span> <span class="op">~</span> <span class="st">"fizz"</span>,</span></span>
<span class="r-in"><span>  <span class="va">x</span> <span class="op"><a href="https://rdrr.io/r/base/Arithmetic.html" class="external-link">%%</a></span> <span class="fl">7</span> <span class="op">==</span> <span class="fl">0</span> <span class="op">~</span> <span class="st">"buzz"</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [1] NA          NA          NA          NA          "fizz"     </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [6] NA          "buzz"      NA          NA          "fizz"     </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [11] NA          NA          NA          "buzz"      "fizz"     </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [16] NA          NA          NA          NA          "fizz"     </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [21] "buzz"      NA          NA          NA          "fizz"     </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [26] NA          NA          "buzz"      NA          "fizz"     </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [31] NA          NA          NA          NA          "fizz buzz"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [36] NA          NA          NA          NA          "fizz"     </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [41] NA          "buzz"      NA          NA          "fizz"     </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [46] NA          NA          NA          "buzz"      "fizz"     </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [51] NA          NA          NA          NA          "fizz"     </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [56] "buzz"      NA          NA          NA          "fizz"     </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [61] NA          NA          "buzz"      NA          "fizz"     </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [66] NA          NA          NA          NA          "fizz buzz"</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Note that `NA` values on the LHS are treated like `FALSE` and will be</span></span></span>
<span class="r-in"><span><span class="co"># assigned the `.default` value. You must handle them explicitly if you</span></span></span>
<span class="r-in"><span><span class="co"># want to use a different value. The exact way to handle missing values is</span></span></span>
<span class="r-in"><span><span class="co"># dependent on the set of LHS conditions you use.</span></span></span>
<span class="r-in"><span><span class="va">x</span><span class="op">[</span><span class="fl">2</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NA_real_</span></span></span>
<span class="r-in"><span><span class="fu">case_when</span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">x</span> <span class="op"><a href="https://rdrr.io/r/base/Arithmetic.html" class="external-link">%%</a></span> <span class="fl">35</span> <span class="op">==</span> <span class="fl">0</span> <span class="op">~</span> <span class="st">"fizz buzz"</span>,</span></span>
<span class="r-in"><span>  <span class="va">x</span> <span class="op"><a href="https://rdrr.io/r/base/Arithmetic.html" class="external-link">%%</a></span> <span class="fl">5</span> <span class="op">==</span> <span class="fl">0</span> <span class="op">~</span> <span class="st">"fizz"</span>,</span></span>
<span class="r-in"><span>  <span class="va">x</span> <span class="op"><a href="https://rdrr.io/r/base/Arithmetic.html" class="external-link">%%</a></span> <span class="fl">7</span> <span class="op">==</span> <span class="fl">0</span> <span class="op">~</span> <span class="st">"buzz"</span>,</span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">~</span> <span class="st">"nope"</span>,</span></span>
<span class="r-in"><span>  .default <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [1] "1"         "nope"      "nope"      "nope"      "fizz"     </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [6] "6"         "buzz"      "8"         "9"         "fizz"     </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [11] "11"        "12"        "13"        "buzz"      "fizz"     </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [16] "16"        "17"        "18"        "19"        "fizz"     </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [21] "buzz"      "22"        "23"        "24"        "fizz"     </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [26] "26"        "27"        "buzz"      "29"        "fizz"     </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [31] "31"        "32"        "33"        "34"        "fizz buzz"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [36] "36"        "37"        "38"        "39"        "fizz"     </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [41] "41"        "buzz"      "43"        "44"        "fizz"     </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [46] "46"        "47"        "48"        "buzz"      "fizz"     </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [51] "51"        "52"        "53"        "54"        "fizz"     </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [56] "buzz"      "57"        "58"        "59"        "fizz"     </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [61] "61"        "62"        "buzz"      "64"        "fizz"     </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [66] "66"        "67"        "68"        "69"        "fizz buzz"</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># `case_when()` is not a replacement for basic if/else control flow. When</span></span></span>
<span class="r-in"><span><span class="co"># you have a single scalar condition, using if/else is faster, simpler to</span></span></span>
<span class="r-in"><span><span class="co"># reason about, and is lazy on the branch that isn't run. For example, this</span></span></span>
<span class="r-in"><span><span class="co"># seems to work:</span></span></span>
<span class="r-in"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="st">"value"</span></span></span>
<span class="r-in"><span><span class="fu">case_when</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">is.character</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">~</span> <span class="va">x</span>, .default <span class="op">=</span> <span class="st">"not-a-character"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "value"</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Until `x` is a non-character type</span></span></span>
<span class="r-in"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fl">1</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/try.html" class="external-link">try</a></span><span class="op">(</span><span class="fu">case_when</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">is.character</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">~</span> <span class="va">x</span>, .default <span class="op">=</span> <span class="st">"not-a-character"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Error in case_when(is.character(x) ~ x, .default = "not-a-character") : </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Can't combine &lt;double&gt; and `.default` &lt;character&gt;.</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Instead, you should use if/else</span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">is.character</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="va">y</span> <span class="op">&lt;-</span> <span class="va">x</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="va">y</span> <span class="op">&lt;-</span> <span class="st">"not-a-character"</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span><span class="va">y</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "not-a-character"</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># If you believe that you've covered every possible case, then set</span></span></span>
<span class="r-in"><span><span class="co"># `.unmatched = "error"` rather than supplying a `.default`. This adds an</span></span></span>
<span class="r-in"><span><span class="co"># extra layer of safety to `case_when()` and is particularly useful when you</span></span></span>
<span class="r-in"><span><span class="co"># have a series of complex expressions!</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">50</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Oops, we forgot to handle `50`</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/try.html" class="external-link">try</a></span><span class="op">(</span><span class="fu">case_when</span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">x</span> <span class="op">&lt;</span> <span class="fl">10</span> <span class="op">~</span> <span class="st">"ten"</span>,</span></span>
<span class="r-in"><span>  <span class="va">x</span> <span class="op">&lt;</span> <span class="fl">20</span> <span class="op">~</span> <span class="st">"twenty"</span>,</span></span>
<span class="r-in"><span>  <span class="va">x</span> <span class="op">&lt;</span> <span class="fl">30</span> <span class="op">~</span> <span class="st">"thirty"</span>,</span></span>
<span class="r-in"><span>  <span class="va">x</span> <span class="op">&lt;</span> <span class="fl">40</span> <span class="op">~</span> <span class="st">"forty"</span>,</span></span>
<span class="r-in"><span>  <span class="va">x</span> <span class="op">&lt;</span> <span class="fl">50</span> <span class="op">~</span> <span class="st">"fifty"</span>,</span></span>
<span class="r-in"><span>  .unmatched <span class="op">=</span> <span class="st">"error"</span></span></span>
<span class="r-in"><span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Error in case_when(x &lt; 10 ~ "ten", x &lt; 20 ~ "twenty", x &lt; 30 ~ "thirty",  : </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Each location must be matched.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BB0000;">✖</span> Location 31 is unmatched.</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu">case_when</span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">x</span> <span class="op">&lt;</span> <span class="fl">10</span> <span class="op">~</span> <span class="st">"ten"</span>,</span></span>
<span class="r-in"><span>  <span class="va">x</span> <span class="op">&lt;</span> <span class="fl">20</span> <span class="op">~</span> <span class="st">"twenty"</span>,</span></span>
<span class="r-in"><span>  <span class="va">x</span> <span class="op">&lt;</span> <span class="fl">30</span> <span class="op">~</span> <span class="st">"thirty"</span>,</span></span>
<span class="r-in"><span>  <span class="va">x</span> <span class="op">&lt;</span> <span class="fl">40</span> <span class="op">~</span> <span class="st">"forty"</span>,</span></span>
<span class="r-in"><span>  <span class="va">x</span> <span class="op">&lt;=</span> <span class="fl">50</span> <span class="op">~</span> <span class="st">"fifty"</span>,</span></span>
<span class="r-in"><span>  .unmatched <span class="op">=</span> <span class="st">"error"</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [1] "forty"  "twenty" "twenty" "ten"    "fifty"  "fifty"  "forty" </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [8] "fifty"  "thirty" "thirty" "thirty" "ten"    "fifty"  "thirty"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [15] "ten"    "thirty" "ten"    "fifty"  "ten"    "twenty" "forty" </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [22] "twenty" "ten"    "fifty"  "twenty" "twenty" "forty"  "thirty"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [29] "twenty" "fifty"  "fifty"  "twenty" "thirty" "forty"  "forty" </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [36] "thirty" "twenty" "fifty"  "thirty" "forty"  "forty"  "forty" </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [43] "fifty"  "ten"    "ten"    "ten"    "thirty" "fifty"  "twenty"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [50] "forty" </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Note that `NA` is considered unmatched and must be handled with its own</span></span></span>
<span class="r-in"><span><span class="co"># explicit case, even if that case just propagates the missing value!</span></span></span>
<span class="r-in"><span><span class="va">x</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">5</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NA</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu">case_when</span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">x</span> <span class="op">&lt;</span> <span class="fl">10</span> <span class="op">~</span> <span class="st">"ten"</span>,</span></span>
<span class="r-in"><span>  <span class="va">x</span> <span class="op">&lt;</span> <span class="fl">20</span> <span class="op">~</span> <span class="st">"twenty"</span>,</span></span>
<span class="r-in"><span>  <span class="va">x</span> <span class="op">&lt;</span> <span class="fl">30</span> <span class="op">~</span> <span class="st">"thirty"</span>,</span></span>
<span class="r-in"><span>  <span class="va">x</span> <span class="op">&lt;</span> <span class="fl">40</span> <span class="op">~</span> <span class="st">"forty"</span>,</span></span>
<span class="r-in"><span>  <span class="va">x</span> <span class="op">&lt;=</span> <span class="fl">50</span> <span class="op">~</span> <span class="st">"fifty"</span>,</span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">~</span> <span class="cn">NA</span>,</span></span>
<span class="r-in"><span>  .unmatched <span class="op">=</span> <span class="st">"error"</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [1] "forty"  NA       "twenty" "ten"    NA       "fifty"  "forty" </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [8] "fifty"  "thirty" "thirty" "thirty" "ten"    "fifty"  "thirty"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [15] "ten"    "thirty" "ten"    "fifty"  "ten"    "twenty" "forty" </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [22] "twenty" "ten"    "fifty"  "twenty" "twenty" "forty"  "thirty"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [29] "twenty" "fifty"  "fifty"  "twenty" "thirty" "forty"  "forty" </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [36] "thirty" "twenty" "fifty"  "thirty" "forty"  "forty"  "forty" </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [43] "fifty"  "ten"    "ten"    "ten"    "thirty" "fifty"  "twenty"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [50] "forty" </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># `replace_when()` is useful when you're updating an existing vector,</span></span></span>
<span class="r-in"><span><span class="co"># rather than creating an entirely new one. Note the so-far unused "puppy"</span></span></span>
<span class="r-in"><span><span class="co"># factor level:</span></span></span>
<span class="r-in"><span><span class="va">pets</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Max"</span>, <span class="st">"Bella"</span>, <span class="st">"Chuck"</span>, <span class="st">"Luna"</span>, <span class="st">"Cooper"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"dog"</span>, <span class="st">"dog"</span>, <span class="st">"cat"</span>, <span class="st">"dog"</span>, <span class="st">"cat"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"dog"</span>, <span class="st">"cat"</span>, <span class="st">"puppy"</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">)</span>,</span></span>
<span class="r-in"><span>  age <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">3</span>, <span class="fl">5</span>, <span class="fl">2</span>, <span class="fl">4</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># We can replace some values with `"puppy"` based on arbitrary conditions.</span></span></span>
<span class="r-in"><span><span class="co"># Even though we are using a character `"puppy"` value, `replace_when()` will</span></span></span>
<span class="r-in"><span><span class="co"># automatically cast it to the factor type of `type` for us.</span></span></span>
<span class="r-in"><span><span class="va">pets</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="mutate.html">mutate</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    type <span class="op">=</span> <span class="fu">replace_when</span><span class="op">(</span><span class="va">type</span>, <span class="va">type</span> <span class="op">==</span> <span class="st">"dog"</span> <span class="op">&amp;</span> <span class="va">age</span> <span class="op">&lt;=</span> <span class="fl">2</span> <span class="op">~</span> <span class="st">"puppy"</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># A tibble: 5 × 3</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   name   type    age</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">1</span> Max    puppy     1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">2</span> Bella  dog       3</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">3</span> Chuck  cat       5</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">4</span> Luna   puppy     2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">5</span> Cooper cat       4</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Compare that with this `case_when()` call, which loses the factor class.</span></span></span>
<span class="r-in"><span><span class="co"># It's always better to use `replace_when()` when updating a few values in</span></span></span>
<span class="r-in"><span><span class="co"># an existing vector!</span></span></span>
<span class="r-in"><span><span class="va">pets</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="mutate.html">mutate</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    type <span class="op">=</span> <span class="fu">case_when</span><span class="op">(</span><span class="va">type</span> <span class="op">==</span> <span class="st">"dog"</span> <span class="op">&amp;</span> <span class="va">age</span> <span class="op">&lt;=</span> <span class="fl">2</span> <span class="op">~</span> <span class="st">"puppy"</span>, .default <span class="op">=</span> <span class="va">type</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># A tibble: 5 × 3</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   name   type    age</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">1</span> Max    puppy     1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">2</span> Bella  dog       3</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">3</span> Chuck  cat       5</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">4</span> Luna   puppy     2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">5</span> Cooper cat       4</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># `case_when()` and `replace_when()` evaluate all RHS expressions, and then</span></span></span>
<span class="r-in"><span><span class="co"># construct their result by extracting the selected (via the LHS expressions)</span></span></span>
<span class="r-in"><span><span class="co"># parts. For example, `NaN`s are produced here because `sqrt(y)` is evaluated</span></span></span>
<span class="r-in"><span><span class="co"># on all of `y`, not just where `y &gt;= 0`.</span></span></span>
<span class="r-in"><span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="op">-</span><span class="fl">2</span>, <span class="fl">2</span>, by <span class="op">=</span> <span class="fl">.5</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">replace_when</span><span class="op">(</span><span class="va">y</span>, <span class="va">y</span> <span class="op">&gt;=</span> <span class="fl">0</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>NaNs produced</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] -2.0000000 -1.5000000 -1.0000000 -0.5000000  0.0000000  0.7071068</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [7]  1.0000000  1.2247449  1.4142136</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># These functions are particularly useful inside `mutate()` when you want to</span></span></span>
<span class="r-in"><span><span class="co"># create a new variable that relies on a complex combination of existing</span></span></span>
<span class="r-in"><span><span class="co"># variables</span></span></span>
<span class="r-in"><span><span class="va">starwars</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="select.html">select</a></span><span class="op">(</span><span class="va">name</span><span class="op">:</span><span class="va">mass</span>, <span class="va">gender</span>, <span class="va">species</span><span class="op">)</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="mutate.html">mutate</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    type <span class="op">=</span> <span class="fu">case_when</span><span class="op">(</span></span></span>
<span class="r-in"><span>      <span class="va">height</span> <span class="op">&gt;</span> <span class="fl">200</span> <span class="op">|</span> <span class="va">mass</span> <span class="op">&gt;</span> <span class="fl">200</span> <span class="op">~</span> <span class="st">"large"</span>,</span></span>
<span class="r-in"><span>      <span class="va">species</span> <span class="op">==</span> <span class="st">"Droid"</span> <span class="op">~</span> <span class="st">"robot"</span>,</span></span>
<span class="r-in"><span>      .default <span class="op">=</span> <span class="st">"other"</span></span></span>
<span class="r-in"><span>    <span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># A tibble: 87 × 6</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    name               height  mass gender    species type </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>               <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 1</span> Luke Skywalker        172    77 masculine Human   other</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 2</span> C-3PO                 167    75 masculine Droid   robot</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 3</span> R2-D2                  96    32 masculine Droid   robot</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 4</span> Darth Vader           202   136 masculine Human   large</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 5</span> Leia Organa           150    49 feminine  Human   other</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 6</span> Owen Lars             178   120 masculine Human   other</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 7</span> Beru Whitesun Lars    165    75 feminine  Human   other</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 8</span> R5-D4                  97    32 masculine Droid   robot</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 9</span> Biggs Darklighter     183    84 masculine Human   other</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">10</span> Obi-Wan Kenobi        182    77 masculine Human   other</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># ℹ 77 more rows</span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># `case_when()` is not a tidy eval function. If you'd like to reuse</span></span></span>
<span class="r-in"><span><span class="co"># the same patterns, extract the `case_when()` call into a normal</span></span></span>
<span class="r-in"><span><span class="co"># function:</span></span></span>
<span class="r-in"><span><span class="va">case_character_type</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">height</span>, <span class="va">mass</span>, <span class="va">species</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="fu">case_when</span><span class="op">(</span></span></span>
<span class="r-in"><span>    <span class="va">height</span> <span class="op">&gt;</span> <span class="fl">200</span> <span class="op">|</span> <span class="va">mass</span> <span class="op">&gt;</span> <span class="fl">200</span> <span class="op">~</span> <span class="st">"large"</span>,</span></span>
<span class="r-in"><span>    <span class="va">species</span> <span class="op">==</span> <span class="st">"Droid"</span> <span class="op">~</span> <span class="st">"robot"</span>,</span></span>
<span class="r-in"><span>    .default <span class="op">=</span> <span class="st">"other"</span></span></span>
<span class="r-in"><span>  <span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu">case_character_type</span><span class="op">(</span><span class="fl">150</span>, <span class="fl">250</span>, <span class="st">"Droid"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "large"</span>
<span class="r-in"><span><span class="fu">case_character_type</span><span class="op">(</span><span class="fl">150</span>, <span class="fl">150</span>, <span class="st">"Droid"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "robot"</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Such functions can be used inside `mutate()` as well:</span></span></span>
<span class="r-in"><span><span class="va">starwars</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="mutate.html">mutate</a></span><span class="op">(</span>type <span class="op">=</span> <span class="fu">case_character_type</span><span class="op">(</span><span class="va">height</span>, <span class="va">mass</span>, <span class="va">species</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="pull.html">pull</a></span><span class="op">(</span><span class="va">type</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [1] "other" "robot" "robot" "large" "other" "other" "other" "robot"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [9] "other" "other" "other" "other" "large" "other" "other" "large"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [17] "other" "other" "other" "other" "other" "robot" "other" "other"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [25] "other" "other" "other" "other" "other" "other" "other" "other"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [33] "other" "other" "other" "large" "large" "other" "other" "other"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [41] "other" "other" "other" "other" "other" "other" "other" "other"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [49] "other" "other" "other" "other" "other" "other" "other" "large"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [57] "other" "other" "other" "other" "other" "other" "other" "other"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [65] "other" "other" "other" "other" "other" "other" "large" "large"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [73] "other" "robot" "other" "other" "other" "large" "large" "other"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [81] "other" "large" "other" "other" "other" "robot" "other"</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># `case_when()` ignores `NULL` inputs. This is useful when you'd</span></span></span>
<span class="r-in"><span><span class="co"># like to use a pattern only under certain conditions. Here we'll</span></span></span>
<span class="r-in"><span><span class="co"># take advantage of the fact that `if` returns `NULL` when there is</span></span></span>
<span class="r-in"><span><span class="co"># no `else` clause:</span></span></span>
<span class="r-in"><span><span class="va">case_character_type</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">height</span>, <span class="va">mass</span>, <span class="va">species</span>, <span class="va">robots</span> <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="fu">case_when</span><span class="op">(</span></span></span>
<span class="r-in"><span>    <span class="va">height</span> <span class="op">&gt;</span> <span class="fl">200</span> <span class="op">|</span> <span class="va">mass</span> <span class="op">&gt;</span> <span class="fl">200</span> <span class="op">~</span> <span class="st">"large"</span>,</span></span>
<span class="r-in"><span>    <span class="kw">if</span> <span class="op">(</span><span class="va">robots</span><span class="op">)</span> <span class="va">species</span> <span class="op">==</span> <span class="st">"Droid"</span> <span class="op">~</span> <span class="st">"robot"</span>,</span></span>
<span class="r-in"><span>    .default <span class="op">=</span> <span class="st">"other"</span></span></span>
<span class="r-in"><span>  <span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">starwars</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="mutate.html">mutate</a></span><span class="op">(</span>type <span class="op">=</span> <span class="fu">case_character_type</span><span class="op">(</span><span class="va">height</span>, <span class="va">mass</span>, <span class="va">species</span>, robots <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="pull.html">pull</a></span><span class="op">(</span><span class="va">type</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [1] "other" "other" "other" "large" "other" "other" "other" "other"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [9] "other" "other" "other" "other" "large" "other" "other" "large"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [17] "other" "other" "other" "other" "other" "other" "other" "other"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [25] "other" "other" "other" "other" "other" "other" "other" "other"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [33] "other" "other" "other" "large" "large" "other" "other" "other"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [41] "other" "other" "other" "other" "other" "other" "other" "other"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [49] "other" "other" "other" "other" "other" "other" "other" "large"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [57] "other" "other" "other" "other" "other" "other" "other" "other"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [65] "other" "other" "other" "other" "other" "other" "large" "large"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [73] "other" "other" "other" "other" "other" "large" "large" "other"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [81] "other" "large" "other" "other" "other" "other" "other"</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># `replace_when()` can also be used in combination with `pick()` to</span></span></span>
<span class="r-in"><span><span class="co"># conditionally mutate rows within multiple columns using a single condition.</span></span></span>
<span class="r-in"><span><span class="co"># Here `replace_when()` returns a data frame with new `species` and `name`</span></span></span>
<span class="r-in"><span><span class="co"># columns, which `mutate()` then automatically unpacks.</span></span></span>
<span class="r-in"><span><span class="va">starwars</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="select.html">select</a></span><span class="op">(</span><span class="va">homeworld</span>, <span class="va">species</span>, <span class="va">name</span><span class="op">)</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="mutate.html">mutate</a></span><span class="op">(</span><span class="fu">replace_when</span><span class="op">(</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="pick.html">pick</a></span><span class="op">(</span><span class="va">species</span>, <span class="va">name</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    <span class="va">homeworld</span> <span class="op">==</span> <span class="st">"Tatooine"</span> <span class="op">~</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>      species <span class="op">=</span> <span class="st">"Tatooinese"</span>,</span></span>
<span class="r-in"><span>      name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">name</span>, <span class="st">"(Tatooine)"</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># A tibble: 87 × 3</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    homeworld species    name                         </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                        </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 1</span> Tatooine  Tatooinese Luke Skywalker (Tatooine)    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 2</span> Tatooine  Tatooinese C-3PO (Tatooine)             </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 3</span> Naboo     Droid      R2-D2                        </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 4</span> Tatooine  Tatooinese Darth Vader (Tatooine)       </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 5</span> Alderaan  Human      Leia Organa                  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 6</span> Tatooine  Tatooinese Owen Lars (Tatooine)         </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 7</span> Tatooine  Tatooinese Beru Whitesun Lars (Tatooine)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 8</span> Tatooine  Tatooinese R5-D4 (Tatooine)             </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 9</span> Tatooine  Tatooinese Biggs Darklighter (Tatooine) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">10</span> Stewjon   Human      Obi-Wan Kenobi               </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># ℹ 77 more rows</span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


   </div>
  <footer><div class="container">
  <div class="pkgdown-footer-left">
  <p>Developed by <a href="https://hadley.nz" class="external-link">Hadley Wickham</a>, <a href="https://github.com/romainfrancois" class="external-link">Romain François</a>, <a href="https://github.com/lionel-" class="external-link">Lionel Henry</a>, <a href="https://krlmlr.info" class="external-link">Kirill Müller</a>, <a href="https://github.com/DavisVaughan" class="external-link">Davis Vaughan</a>, <a href="https://www.posit.co" class="external-link"><img src="https://www.tidyverse.org/posit-logo.svg" alt="Posit" height="16" width="62" style="margin-bottom: 3px;"></a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

  </div></footer></body></html>

